<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutri-Track S√®che 10 Sem - Hocine</title>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background:
                linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><rect fill="%23667eea" width="100" height="100" opacity="0.05"/><circle cx="25" cy="25" r="20" fill="%23764ba2" opacity="0.1"/><circle cx="75" cy="75" r="20" fill="%23764ba2" opacity="0.1"/><path d="M30,10 Q40,20 50,10 T70,10" stroke="%2351cf66" fill="none" opacity="0.15" stroke-width="2"/><path d="M10,50 Q20,60 30,50 T50,50" stroke="%2351cf66" fill="none" opacity="0.15" stroke-width="2"/></svg>');
            background-size: cover, 100px 100px;
            min-height: 100vh;
            padding: 15px;
            color: #333;
        }
        .container {max-width: 950px; margin: 0 auto; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);}
        h1 {text-align: center; color: #667eea; margin-bottom: 5px; font-size: 26px;}
        .version-badge {text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; display: inline-block; margin: 5px;}
        .gas-badge {background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);}
        .season-badge {background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%);}
        .cholesterol-badge {background: linear-gradient(135deg, #fab005 0%, #f59f00 100%);}
        .header-info {text-align: center; color: #666; margin-bottom: 15px; font-size: 13px;}
        .timeline-container {background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 20px; border-radius: 15px; margin-bottom: 20px; overflow-x: auto;}
        .timeline {display: flex; justify-content: space-between; align-items: center; position: relative; max-width: 100%;}
        .timeline-line {position: absolute; top: 50%; left: 5%; right: 5%; height: 4px; background: #dee2e6; z-index: 0; transform: translateY(-50%);}
        .timeline-progress {position: absolute; top: 50%; left: 5%; height: 4px; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); z-index: 1; transform: translateY(-50%); transition: width 0.5s;}
        .timeline-item {position: relative; z-index: 2; text-align: center; cursor: pointer; flex: 1; padding: 5px;}
        .timeline-dot {width: 40px; height: 40px; border-radius: 50%; background: white; border: 4px solid #dee2e6; margin: 0 auto 5px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; transition: all 0.3s;}
        .timeline-item.active .timeline-dot {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; transform: scale(1.2);}
        .timeline-item.completed .timeline-dot {background: #51cf66; border-color: #51cf66; color: white;}
        .timeline-item.future .timeline-dot {background: #f8f9fa; border-color: #dee2e6;}
        .timeline-label {font-size: 11px; font-weight: bold; color: #666;}
        .timeline-phase {font-size: 9px; color: #999; margin-top: 2px;}
        .day-tracker {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; text-align: center;}
        .day-display {font-size: 28px; font-weight: bold; margin: 10px 0;}
        .day-controls {display: flex; gap: 8px; justify-content: center; margin-top: 10px; flex-wrap: wrap;}
        .auto-save-indicator {position: fixed; top: 20px; right: 20px; background: #51cf66; color: white; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: bold; opacity: 0; transition: opacity 0.3s; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);}
        .auto-save-indicator.show {opacity: 1;}
        .custom-notification {position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 3000; max-width: 400px; text-align: center; cursor: pointer;}
        .custom-notification.success {border-left: 6px solid #51cf66;}
        .custom-notification.error {border-left: 6px solid #ff6b6b;}
        .custom-notification.warning {border-left: 6px solid #ffc107;}
        .notification-overlay {position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2999; cursor: pointer;}
        .tabs {display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 8px; margin-bottom: 20px;}
        .tab {padding: 12px 8px; background: #f0f0f0; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s; font-size: 12px;}
        .tab.active {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);}
        .tab-content {display: none;}
        .tab-content.active {display: block; animation: fadeIn 0.4s;}
        @keyframes fadeIn {from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);}}
        @keyframes slideIn {from {opacity: 0; transform: translateX(100px);} to {opacity: 1; transform: translateX(0);}}
        @keyframes slideOut {from {opacity: 1; transform: translateX(0);} to {opacity: 0; transform: translateX(100px);}}
        .nutrition-section {background: #f0f4ff; border-radius: 15px; padding: 15px; margin-bottom: 15px; border-left: 5px solid #667eea;}
        .nutrition-section h3 {color: #667eea; margin-bottom: 12px; font-size: 18px;}
        .meal {background: white; padding: 12px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
        .meal-details {display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 6px; margin: 8px 0; font-size: 12px;}
        .detail-item {background: #f0f0f0; padding: 5px 8px; border-radius: 6px;}
        .detail-label {font-weight: bold; color: #667eea;}
        .meal-foods {background: #f9fafb; border-radius: 8px; padding: 10px; margin: 10px 0; font-size: 13px; line-height: 1.6;}
        .meal-foods ul {margin-left: 20px;}
        .season-tag {background: #fff9e6; color: #ff6b00; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-left: 5px;}
        .cholesterol-tag {background: #fff3bf; color: #f59f00; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-left: 5px;}
        /* üÜï Styles pour suppl√©ments et ajouts anti-inflammatoires */
        .supplements-box {background: #e8f5e9; border-left: 4px solid #51cf66; padding: 10px; margin: 10px 0; border-radius: 6px; font-size: 12px;}
        .anti-inflam-box {background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin: 10px 0; border-radius: 6px; font-size: 12px;}
        .gas-tip {background: #e8f5e9; border-left: 4px solid #51cf66; padding: 10px; margin: 10px 0; border-radius: 6px; font-size: 12px;}
        .hydration-note {background: #e3f2fd; border-left: 4px solid #2196f3; padding: 10px; margin: 10px 0; border-radius: 6px; font-size: 12px;}
        .validation-checkbox {display: flex; align-items: center; gap: 10px; background: #e8f5e9; padding: 10px; border-radius: 8px; margin-top: 10px; cursor: pointer;}
        .validation-checkbox input {width: 20px; height: 20px; cursor: pointer;}
        .validation-checkbox.validated {background: #c8e6c9;}
        .progress-card {background: white; padding: 15px; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
        .progress-bar-container {background: #e0e0e0; border-radius: 10px; height: 30px; margin: 10px 0; overflow: hidden;}
        .progress-bar {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; transition: width 0.5s; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;}
        .macro-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin: 15px 0;}
        .macro-card {background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%); padding: 15px; border-radius: 10px; text-align: center;}
        .macro-card.calories {background: linear-gradient(135deg, #ffd93d 0%, #ff9800 100%); color: white;}
        .macro-card.proteines {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;}
        .macro-card.glucides {background: linear-gradient(135deg, #ffa500 0%, #ff6347 100%); color: white;}
        .macro-card.lipides {background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white;}
        .macro-card.hydration {background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white;}
        .macro-value {font-size: 28px; font-weight: bold; margin: 5px 0;}
        .macro-label {font-size: 11px; opacity: 0.9; text-transform: uppercase;}
        .week-card {background: white; border-radius: 15px; padding: 20px; margin: 15px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-left: 6px solid #667eea;}
        .week-card.agressive {border-left-color: #ff6b6b;}
        .week-card.deload {border-left-color: #ffc107;}
        .week-card.moderee {border-left-color: #51cf66;}
        .week-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;}
        .week-title {font-size: 22px; font-weight: bold; color: #667eea;}
        .phase-badge {padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; color: white;}
        .phase-badge.agressive {background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%);}
        .phase-badge.deload {background: linear-gradient(135deg, #ffc107 0%, #ffd54f 100%);}
        .phase-badge.moderee {background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);}
        .stats-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin: 15px 0;}
        .stat-item {background: #f8f9fa; padding: 12px; border-radius: 8px; text-align: center;}
        .stat-value {font-size: 24px; font-weight: bold; color: #667eea; margin: 5px 0;}
        .stat-label {font-size: 11px; color: #666; text-transform: uppercase;}
        .chart-container {background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 15px 0; min-height: 300px; position: relative;}
        .chart-svg {width: 100%; height: 250px;}
        .form-group {margin: 15px 0;}
        .form-label {display: block; font-weight: bold; color: #667eea; margin-bottom: 8px; font-size: 14px;}
        .form-input {width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border 0.3s;}
        .form-input:focus {border-color: #667eea; outline: none;}
        .form-row {display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;}
        .alert-box {padding: 15px; border-radius: 10px; margin: 15px 0; font-size: 14px; border-left: 4px solid;}
        .alert-success {background: #e8f5e9; border-color: #51cf66; color: #2e7d32;}
        .alert-warning {background: #fff9e6; border-color: #ffc107; color: #f57c00;}
        .alert-danger {background: #ffebee; border-color: #ff6b6b; color: #c62828;}
        .alert-info {background: #e3f2fd; border-color: #2196f3; color: #1565c0;}
        .grignotage-section {background: #fff9e6; border-left: 5px solid #ffc107; padding: 15px; border-radius: 15px; margin: 15px 0;}
        .grignotage-item {background: white; padding: 10px; margin: 8px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;}
        .btn {padding: 10px 16px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s; font-size: 13px;}
        .btn-primary {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;}
        .btn-primary:hover {transform: scale(1.05); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);}
        .btn-secondary {background: rgba(255,255,255,0.2); color: white; border: 2px solid white;}
        .btn-danger {background: #ff6b6b; color: white;}
        .btn-success {background: #51cf66; color: white;}
        .modal {display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; overflow-y: auto;}
        .modal.show {display: flex;}
        .modal-content {background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; margin: 20px; animation: modalPop 0.3s; max-height: 90vh; overflow-y: auto;}
        @keyframes modalPop {from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;}}
        .modal-header {font-size: 22px; font-weight: bold; color: #667eea; margin-bottom: 15px; text-align: center;}
        .modal-body {margin: 15px 0;}
        .notes-area {width: 100%; min-height: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 13px; margin-top: 10px;}
        .info-box {background: #e3f2fd; border-left: 4px solid #2196f3; padding: 12px; border-radius: 8px; margin: 10px 0; font-size: 13px;}
        .warning-box {background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; border-radius: 8px; margin: 10px 0; font-size: 13px;}
        .option-selector {background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 10px 0;}
        .option-btn {padding: 8px 16px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; margin: 4px; cursor: pointer; font-size: 12px; font-weight: bold; transition: all 0.3s;}
        .option-btn.active {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea;}
        @media (max-width: 600px) {.container {padding: 12px;} h1 {font-size: 22px;} .macro-grid, .stats-grid {grid-template-columns: repeat(2, 1fr);} .timeline-item {padding: 2px;} .timeline-dot {width: 30px; height: 30px; font-size: 10px;} .timeline-label, .timeline-phase {font-size: 9px;}}
    </style>
</head>
<body>
    <div class="auto-save-indicator" id="auto-save-indicator">‚úÖ Sauvegard√©</div>
    <div class="container">
        <h1>üî• PLAN S√àCHE 10 SEMAINES</h1>
        <div style="text-align: center;">
            <span class="version-badge">v5.0 S√àCHE ‚Ä¢ Hocine 44 ans</span>
            <span class="version-badge season-badge" id="season-badge">üçÇ AUTOMNE</span>
        </div>
        <!-- üÜï SECTION MES MESURES √âDITABLE -->
        <div class="week-card" style="margin-bottom: 20px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);">
            <h3 style="color: #51cf66; margin-bottom: 15px; cursor: pointer;" onclick="toggleMesuresEdit()">üìä MES MESURES <span style="font-size: 12px;">(cliquer pour √©diter)</span></h3>

            <div id="mesures-display" style="text-align: center; font-size: 15px; color: #333;">
                <strong id="display-poids">93.4</strong>kg ‚Ä¢
                <strong id="display-taille">105</strong>cm taille ‚Ä¢
                Objectif <strong id="display-objectif">88</strong>kg en 10 semaines
            </div>

            <div id="mesures-edit" style="display: none; animation: fadeIn 0.3s;">
                <div class="form-row" style="gap: 10px;">
                    <div class="form-group" style="margin: 5px 0;">
                        <label class="form-label" style="font-size: 12px;">‚öñÔ∏è Poids actuel (kg)</label>
                        <input type="number" step="0.1" class="form-input" id="input-poids-actuel" value="93.4" oninput="updateMesures()">
                    </div>
                    <div class="form-group" style="margin: 5px 0;">
                        <label class="form-label" style="font-size: 12px;">üìè Tour taille (cm)</label>
                        <input type="number" step="0.5" class="form-input" id="input-taille-actuel" value="105" oninput="updateMesures()">
                    </div>
                    <div class="form-group" style="margin: 5px 0;">
                        <label class="form-label" style="font-size: 12px;">üéØ Objectif (kg)</label>
                        <input type="number" step="0.1" class="form-input" id="input-objectif" value="88" oninput="updateMesures()">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 10px; color: #51cf66; font-size: 12px;">
                    ‚úÖ Sauvegarde automatique ‚Ä¢ Perte vis√©e: <strong id="perte-visee">5.4</strong>kg
                </div>
            </div>
        </div>

        <div class="timeline-container">
            <div style="text-align: center; margin-bottom: 15px; font-weight: bold; color: #667eea;">PROGRESSION 10 SEMAINES</div>
            <div class="timeline">
                <div class="timeline-line"></div>
                <div class="timeline-progress" id="timeline-progress" style="width: 0%"></div>
                <div class="timeline-item" onclick="afficherSemaine(1)">
                    <div class="timeline-dot">S1</div>
                    <div class="timeline-label">Semaine 1</div>
                    <div class="timeline-phase">S√®che</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(2)">
                    <div class="timeline-dot">S2</div>
                    <div class="timeline-label">Semaine 2</div>
                    <div class="timeline-phase">S√®che</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(3)">
                    <div class="timeline-dot">S3</div>
                    <div class="timeline-label">Semaine 3</div>
                    <div class="timeline-phase">S√®che</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(4)">
                    <div class="timeline-dot">S4</div>
                    <div class="timeline-label">Semaine 4</div>
                    <div class="timeline-phase">S√®che</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(5)">
                    <div class="timeline-dot">S5</div>
                    <div class="timeline-label">Semaine 5</div>
                    <div class="timeline-phase">Deload</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(6)">
                    <div class="timeline-dot">S6</div>
                    <div class="timeline-label">Semaine 6</div>
                    <div class="timeline-phase">S√®che</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(7)">
                    <div class="timeline-dot">S7</div>
                    <div class="timeline-label">Semaine 7</div>
                    <div class="timeline-phase">S√®che</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(8)">
                    <div class="timeline-dot">S8</div>
                    <div class="timeline-label">Semaine 8</div>
                    <div class="timeline-phase">S√®che</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(9)">
                    <div class="timeline-dot">S9</div>
                    <div class="timeline-label">Semaine 9</div>
                    <div class="timeline-phase">S√®che</div>
                </div>
                <div class="timeline-item" onclick="afficherSemaine(10)">
                    <div class="timeline-dot">S10</div>
                    <div class="timeline-label">Semaine 10</div>
                    <div class="timeline-phase">Finale</div>
                </div>
            </div>
        </div>

        <div class="day-tracker">
            <div style="font-size: 14px; margin-bottom: 5px;">üìÖ <span id="semaine-actuelle-label">SEMAINE 1</span></div>
            <div class="day-display" id="day-display">üèãÔ∏è JOUR TRAINING</div>
            <div class="day-controls">
                <button class="btn btn-secondary" onclick="setDayType('training')">üèãÔ∏è Training</button>
                <button class="btn btn-secondary" onclick="setDayType('repos')">üí§ Repos</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('menu')">üìã MENU</button>
            <button class="tab" onclick="showTab('suivi10sem')">üìä SUIVI</button>
            <button class="tab" onclick="showTab('saison')">üçÇ SAISON</button>
            <button class="tab" onclick="showTab('supplements')">üíä STACK</button>
            <button class="tab" onclick="showTab('ajustements')">‚öôÔ∏è AJUST</button>
            <button class="tab" onclick="showTab('grignotages')">üç™ SNACKS</button>
            <button class="tab" onclick="showTab('export')">üì§ EXPORT</button>
        </div>

        <div id="tab-menu" class="tab-content active">
            <div class="progress-card">
                <h3 style="color: #667eea; margin-bottom: 10px;">üìä Progression du jour</h3>
                <div class="progress-bar-container"><div class="progress-bar" id="progress-bar" style="width: 0%">0%</div></div>
                <div class="macro-grid">
                    <div class="macro-card calories"><div class="macro-label">Calories</div><div class="macro-value"><span id="cal-actuel">0</span>/<span id="cal-total">2580</span></div></div>
                    <div class="macro-card proteines"><div class="macro-label">Prot√©ines</div><div class="macro-value"><span id="prot-actuel">0</span>/<span id="prot-total">240</span>g</div></div>
                    <div class="macro-card glucides"><div class="macro-label">Glucides</div><div class="macro-value"><span id="gluc-actuel">0</span>/<span id="gluc-total">250</span>g</div></div>
                    <div class="macro-card lipides"><div class="macro-label">Lipides</div><div class="macro-value"><span id="lip-actuel">0</span>/<span id="lip-total">75</span>g</div></div>
                </div>
            </div>
            <div id="menu-container"></div>
            <textarea class="notes-area" id="notes-jour" placeholder="üìù Notes du jour (√©nergie, sensations, digestion...)" oninput="showAutoSave()"></textarea>
        </div>

        <div id="tab-suivi10sem" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 15px;">üìä Suivi Plan S√®che 10 Semaines</h2>
            
            <div id="carte-semaine-actuelle"></div>
            
            <div class="progress-card">
                <h3 style="color: #667eea; margin-bottom: 15px;">üìà √âvolution Poids & Mensurations</h3>
                <div class="chart-container" id="chart-poids">
                    <svg class="chart-svg" id="svg-poids"></svg>
                </div>
            </div>

            <div id="alertes-container"></div>

            <!-- üÜï GRAPHIQUE PROGRESSION POIDS -->
            <div class="week-card" style="background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%); margin-bottom: 20px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">üìà COURBE DE PROGRESSION</h3>
                <canvas id="graph-progression" style="width: 100%; height: 250px;"></canvas>
                <div style="text-align: center; margin-top: 15px; font-size: 13px; color: #666;">
                    Perte moyenne: <strong id="perte-moyenne">-0.5kg</strong>/sem ‚Ä¢
                    Restant: <strong id="kg-restant">5.4kg</strong>
                </div>
            </div>

            <div class="progress-card">
                <h3 style="color: #667eea; margin-bottom: 15px;">üìã Historique Pes√©es</h3>
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="ouvrirFormulairePesee()">‚öñÔ∏è Nouvelle pes√©e (Vendredi/Samedi)</button>
                <div id="historique-pesees"></div>
            </div>
        </div>

        <div id="tab-saison" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 15px;">üçÇ Fruits & L√©gumes de Saison</h2>
            <div class="info-box"><strong>üìÖ Saison actuelle :</strong> <span id="season-name-detail">Automne</span> (mise √† jour automatique)</div>
            <div class="progress-card"><h3>üçé Fruits disponibles</h3><div id="fruits-saison" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div></div>
            <div class="progress-card"><h3>ü•¶ L√©gumes disponibles</h3><div id="legumes-saison" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div></div>
        </div>

        <!-- üÜï NOUVEAU ONGLET STACK SUPPL√âMENTS -->
        <div id="tab-supplements" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 15px;">üíä Stack Suppl√©ments Complet</h2>

            <div class="alert-box alert-info">
                <strong>üìä CO√õT TOTAL MENSUEL</strong><br>
                ‚Ä¢ Stack Basique : 207‚Ç¨/mois (~6.90‚Ç¨/jour)<br>
                ‚Ä¢ Avec Berb√©rine (diab√®te) : 222‚Ç¨/mois<br>
                ‚Ä¢ Stack Complet Diab√®te : 247‚Ç¨/mois<br>
                ‚Ä¢ Maximum avec cholest√©rol : 272‚Ç¨/mois (~9‚Ç¨/jour)
            </div>

            <div id="stack-basique-container"></div>
            <div id="stack-diabete-container"></div>
            <div id="stack-cholesterol-container"></div>
        </div>

        <!-- üÜï NOUVEAU ONGLET AJUSTEMENTS MACROS -->
        <div id="tab-ajustements" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 15px;">‚öôÔ∏è Ajustements Macros</h2>

            <!-- üÜï CALCULATEUR INTERACTIF -->
            <div class="week-card" style="background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%);">
                <h3 style="color: #667eea; margin-bottom: 15px;">üßÆ CALCULATEUR MACROS LIVE</h3>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #667eea;">
                        ü•© Prot√©ines: <span id="calc-p-value">240</span>g
                    </label>
                    <input type="range" min="180" max="280" value="240" step="5" style="width: 100%;"
                           oninput="updateCalculMacros()" id="calc-p-slider">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #ff9800;">
                        üçö Glucides: <span id="calc-g-value">250</span>g
                    </label>
                    <input type="range" min="150" max="350" value="250" step="10" style="width: 100%;"
                           oninput="updateCalculMacros()" id="calc-g-slider">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #51cf66;">
                        ü•ë Lipides: <span id="calc-l-value">75</span>g
                    </label>
                    <input type="range" min="50" max="100" value="75" step="5" style="width: 100%;"
                           oninput="updateCalculMacros()" id="calc-l-slider">
                </div>

                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="font-size: 32px; font-weight: bold; color: #667eea; margin-bottom: 5px;">
                        <span id="calc-total-kcal">2395</span> kcal
                    </div>
                    <div style="font-size: 12px; color: #999;">TOTAL JOURNALIER</div>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; font-size: 13px; color: #666;">
                        P: <strong id="calc-p-kcal">960</strong>kcal ‚Ä¢
                        G: <strong id="calc-g-kcal">1000</strong>kcal ‚Ä¢
                        L: <strong id="calc-l-kcal">675</strong>kcal
                    </div>
                </div>
            </div>

            <div class="alert-box alert-warning">
                <strong>‚ö†Ô∏è QUAND UTILISER CES AJUSTEMENTS ?</strong><br>
                Les menus standards donnent ~200g P / 320g G / 65g L<br>
                Si ta perte de poids stagne >2 semaines, utilise ces ajustements pour respecter STRICTEMENT les macros cibles (240P / 250G / 75L)
            </div>

            <div id="ajustements-container"></div>

            <div class="progress-card">
                <h3 style="color: #667eea; margin-bottom: 15px;">üí° D√©tails Nutritionnels par Aliment</h3>
                <div id="details-nutritionnels-container"></div>
            </div>
        </div>

        <div id="tab-grignotages" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 15px;">üç™ Grignotages</h2>
            <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="openGrignotageModal()">+ Ajouter grignotage</button>
            <div class="grignotage-section" id="liste-grignotages"><p style="color: #999; text-align: center;">Aucun grignotage aujourd'hui üëç</p></div>
            <div class="progress-card"><h3>Total grignotages : <span id="total-grignotages" style="color: #ffc107;">+0 kcal</span></h3></div>
        </div>

        <div id="tab-export" class="tab-content">
            <h2 style="color: #667eea; margin-bottom: 15px;">üì§ Export & Sauvegarde</h2>
            
            <div class="alert-box alert-info" style="margin-bottom: 20px;">
                <strong>üíæ SAUVEGARDE TES DONN√âES !</strong><br>
                Les donn√©es sont stock√©es uniquement dans ton navigateur.<br>
                Fais un backup r√©gulier pour ne rien perdre !
            </div>

            <div class="progress-card">
                <h3 style="color: #667eea; margin-bottom: 15px;">üíæ Sauvegarde compl√®te</h3>
                <button class="btn btn-success" style="width: 100%; margin: 10px 0;" onclick="telechargerBackup()">üíæ T√©l√©charger backup (.json)</button>
                <button class="btn btn-primary" style="width: 100%; margin: 10px 0;" onclick="document.getElementById('input-restore').click()">üì• Restaurer backup</button>
                <input type="file" id="input-restore" accept=".json" style="display: none;" onchange="restaurerBackup(event)">
                <div style="font-size: 12px; color: #999; margin-top: 10px; text-align: center;">
                    Dernier backup : <span id="last-backup-date">Jamais</span>
                </div>
            </div>

            <div class="progress-card">
                <h3 style="color: #667eea; margin-bottom: 15px;">üìã Rapports texte</h3>
                <button class="btn btn-primary" style="width: 100%; margin: 10px 0;" onclick="exportRapport()">üìã Copier rapport du jour</button>
                <button class="btn btn-secondary" style="width: 100%; margin: 10px 0;" onclick="exportRapportSemaine()">üìä Copier rapport semaine</button>
            </div>

            <div class="progress-card">
                <h3 style="color: #667eea; margin-bottom: 15px;">‚öôÔ∏è Gestion</h3>
                <button class="btn btn-danger" style="width: 100%; margin: 10px 0;" onclick="resetJour()">üîÑ Reset jour actuel</button>
                <button class="btn btn-danger" style="width: 100%; margin: 10px 0;" onclick="resetSemaine()">‚ö†Ô∏è Reset semaine actuelle</button>
                <button class="btn btn-danger" style="width: 100%;" onclick="resetTout()">üóëÔ∏è Effacer toutes les donn√©es</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-pesee">
        <div class="modal-content">
            <div class="modal-header">‚öñÔ∏è Nouvelle Pes√©e Hebdomadaire</div>
            <div class="modal-body">
                <div class="info-box" style="margin-bottom: 15px;">
                    <strong>üìÖ Pes√©e id√©ale :</strong> Vendredi ou Samedi matin, √† jeun, apr√®s toilettes
                </div>
                <div class="form-group">
                    <label class="form-label">Semaine concern√©e</label>
                    <select class="form-input" id="input-semaine">
                        <option value="S1">S1 - S√®che</option>
                        <option value="S2">S2 - S√®che</option>
                        <option value="S3">S3 - S√®che</option>
                        <option value="S4">S4 - S√®che</option>
                        <option value="S5">S5 - Deload</option>
                        <option value="S6">S6 - S√®che</option>
                        <option value="S7">S7 - S√®che</option>
                        <option value="S8">S8 - S√®che</option>
                        <option value="S9">S9 - S√®che</option>
                        <option value="S10">S10 - Finale</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">‚öñÔ∏è Poids (kg) *</label>
                        <input type="number" step="0.1" class="form-input" id="input-poids" placeholder="Ex: 92.5">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üìä % Graisse *</label>
                        <input type="number" step="0.1" class="form-input" id="input-bf" placeholder="Ex: 23.5">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">üìè Tour taille (cm)</label>
                        <input type="number" step="0.5" class="form-input" id="input-taille" placeholder="Ex: 103">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üí™ Tour bras (cm)</label>
                        <input type="number" step="0.5" class="form-input" id="input-bras" placeholder="Ex: 38">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">‚ö° √ânergie (/10)</label>
                        <input type="number" min="1" max="10" class="form-input" id="input-energie" placeholder="8">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üåø Digestion (/10)</label>
                        <input type="number" min="1" max="10" class="form-input" id="input-digestion" placeholder="8">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">üìù Notes</label>
                    <textarea class="notes-area" id="input-notes-pesee" placeholder="Sensations, √©nergie training, points √† am√©liorer..." style="min-height: 60px;"></textarea>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal('modal-pesee')">Annuler</button>
                <button class="btn btn-success" style="flex: 1;" onclick="enregistrerPesee()">üíæ Enregistrer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-grignotage">
        <div class="modal-content">
            <div class="modal-header">üç™ Ajouter grignotage</div>
            <div class="modal-body">
                <input type="text" class="form-input" id="input-aliment" placeholder="Aliment (ex: Chocolat noir)">
                <input type="number" class="form-input" id="input-quantite" placeholder="Quantit√© (g)">
                <input type="number" class="form-input" id="input-calories" placeholder="Calories">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal('modal-grignotage')">Annuler</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="ajouterGrignotage()">Ajouter</button>
            </div>
        </div>
    </div>

    <script>
// üÜï Saisons simplifi√©es
const SAISONS={automne:{mois:[9,10,11],nom:'Automne',emoji:'üçÇ',fruits:['Pomme','Poire','Raisin'],legumes:['Courge','Potimarron','Carottes','Courgettes','Brocoli','Haricots verts','√âpinards']},hiver:{mois:[12,1,2],nom:'Hiver',emoji:'‚ùÑÔ∏è',fruits:['Pomme','Poire','Orange','Kiwi'],legumes:['Carottes','Courge','√âpinards','Brocoli']},printemps:{mois:[3,4,5],nom:'Printemps',emoji:'üå∏',fruits:['Fraise','Cerise','Pomme'],legumes:['Carottes','Haricots verts','√âpinards','Asperges']},ete:{mois:[6,7,8],nom:'√ât√©',emoji:'‚òÄÔ∏è',fruits:['P√™che','Abricot','Melon'],legumes:['Courgettes','Haricots verts','Carottes','Tomate']}};

// üÜï PLAN S√àCHE 10 SEMAINES - MACROS AJUST√âES
const PLAN_HYBRIDE = {
    dateDebut: new Date().toISOString().split('T')[0],
    poidsInitial: 93.4,
    tailleInitiale: 105,
    semaines: {
        S1: {phase:'seche',nom:'S√®che S1',objectif:'Kickstart s√®che intensive',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.7,couleur:'#ff6b6b'},
        S2: {phase:'seche',nom:'S√®che S2',objectif:'Acc√©l√©ration perte gras',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.7,couleur:'#ff6b6b'},
        S3: {phase:'seche',nom:'S√®che S3',objectif:'Momentum optimal',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.7,couleur:'#ff6b6b'},
        S4: {phase:'seche',nom:'S√®che S4',objectif:'Finalisation phase 1',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.7,couleur:'#ff6b6b'},
        S5: {phase:'deload',nom:'Deload',objectif:'R√©cup√©ration m√©tabolique',calories:{training:2750,repos:2350},macros:{training:{P:230,G:280,L:85},repos:{P:220,G:200,L:95}},deficitCible:400,perteVisee:0.3,couleur:'#ffc107'},
        S6: {phase:'seche',nom:'S√®che S6',objectif:'Reprise intensit√©',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.7,couleur:'#ff6b6b'},
        S7: {phase:'seche',nom:'S√®che S7',objectif:'Continuation s√®che',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.7,couleur:'#ff6b6b'},
        S8: {phase:'seche',nom:'S√®che S8',objectif:'Phase finale approche',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.7,couleur:'#ff6b6b'},
        S9: {phase:'seche',nom:'S√®che S9',objectif:'Derni√®re ligne droite',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.7,couleur:'#ff6b6b'},
        S10: {phase:'finale',nom:'Finale',objectif:'Bilan final & transition',calories:{training:2580,repos:2100},macros:{training:{P:240,G:250,L:75},repos:{P:240,G:160,L:75}},deficitCible:420,perteVisee:0.5,couleur:'#51cf66'}
    }
};

// üÜï NOUVEAU MENUS_BASE COMPLET AVEC SUPPL√âMENTS
const MENUS_BASE = {
    training: {
        repas: [
            {
                id: 'repas1_training',
                nom: 'REPAS 1 - Pr√©-Training',
                heure: '12:00',
                calories: 980,
                macros: {P: 82, G: 104, L: 28},
                note: '‚è∞ Finir 1h45 avant training (13h45)',
                options: [
                    {
                        id: 'A',
                        nom: 'VARIANTE 1 : POULET + RIZ BASMATI (Base)',
                        macros: {P: 82, G: 104, L: 28, kcal: 960},
                        aliments: [
                            'üçó Poulet blanc grill√©',
                            '   CRU : 280g ‚Üí CUIT : 224g',
                            '   P: 67g / G: 0g / L: 6g / 290 kcal',
                            '',
                            'üçö Riz basmati blanc',
                            '   CRU : 70g ‚Üí CUIT : 210g',
                            '   P: 5g / G: 59g / L: 1g / 265 kcal',
                            '',
                            'ü•¶ L√©gumes vapeur (brocoli, courgettes)',
                            '   CRU : 350g ‚Üí CUIT : 300g',
                            '   P: 9g / G: 18g / L: 1g / 115 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   20ml',
                            '   P: 0g / G: 0g / L: 20g / 180 kcal',
                            '',
                            'üçå Banane',
                            '   120g',
                            '   P: 1g / G: 27g / L: 0g / 110 kcal',
                            '',
                            'üåø Ajouts : Curcuma 5g + Gingembre 5g + Ail 1 gousse'
                        ]
                    },
                    {
                        id: 'B',
                        nom: 'VARIANTE 2 : VIANDE HACH√âE + P√ÇTES COMPL√àTES',
                        macros: {P: 81, G: 100, L: 29, kcal: 968},
                        aliments: [
                            'ü•© Viande hach√©e 5% MG',
                            '   CRU : 280g ‚Üí CUIT : 224g',
                            '   P: 67g / G: 0g / L: 11g / 358 kcal',
                            '',
                            'üçù P√¢tes compl√®tes',
                            '   CRU : 65g ‚Üí CUIT : 180g',
                            '   P: 8g / G: 52g / L: 2g / 258 kcal',
                            '',
                            'üçÖ Sauce tomate maison',
                            '   200g tomates + oignon + ail',
                            '   P: 3g / G: 14g / L: 1g / 75 kcal',
                            '',
                            'ü•ó Salade verte + concombre',
                            '   200g',
                            '   P: 2g / G: 6g / L: 0g / 30 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   15ml',
                            '   P: 0g / G: 0g / L: 15g / 135 kcal',
                            '',
                            'üçé Pomme',
                            '   150g',
                            '   P: 1g / G: 20g / L: 0g / 80 kcal',
                            '',
                            'üí° +1 galette de riz (8g G) pour ajuster',
                            'üåø Ajouts : Basilic frais + Origan + Ail'
                        ]
                    },
                    {
                        id: 'C',
                        nom: 'VARIANTE 3 : SAUMON + QUINOA',
                        macros: {P: 77, G: 98, L: 42, kcal: 971},
                        aliments: [
                            'üêü Saumon sauvage grill√©',
                            '   CRU : 200g ‚Üí CUIT : 160g',
                            '   P: 37g / G: 0g / L: 12g / 255 kcal',
                            '',
                            'üåæ Quinoa cuit',
                            '   CRU : 70g ‚Üí CUIT : 210g',
                            '   P: 10g / G: 53g / L: 4g / 284 kcal',
                            '',
                            'ü•¶ L√©gumes r√¥tis (courgettes, poivrons, aubergines)',
                            '   CRU : 350g ‚Üí CUIT : 280g',
                            '   P: 7g / G: 21g / L: 1g / 120 kcal',
                            '',
                            'ü´í Huile d\'olive + citron',
                            '   20ml',
                            '   P: 0g / G: 0g / L: 20g / 180 kcal',
                            '',
                            'ü•ë Avocat (¬Ω)',
                            '   40g (r√©duit)',
                            '   P: 1g / G: 3g / L: 5g / 56 kcal',
                            '',
                            'üçä Orange',
                            '   150g',
                            '   P: 1g / G: 18g / L: 0g / 75 kcal',
                            '',
                            'üí° +25g whey si besoin (+21g P)',
                            'üåø Ajouts : Coriandre fra√Æche + Citron + Ail'
                        ]
                    },
                    {
                        id: 'D',
                        nom: 'VARIANTE 4 : POISSON BLANC + RIZ + PATATE DOUCE MIX',
                        macros: {P: 81, G: 109, L: 26, kcal: 991},
                        aliments: [
                            'üêü Filet poisson blanc (cabillaud, colin)',
                            '   CRU : 350g ‚Üí CUIT : 280g',
                            '   P: 64g / G: 0g / L: 2g / 270 kcal',
                            '',
                            'üçö Riz basmati',
                            '   CRU : 40g ‚Üí CUIT : 120g',
                            '   P: 3g / G: 34g / L: 0g / 148 kcal',
                            '',
                            'ü•î Patate douce',
                            '   CRU : 120g ‚Üí CUIT : 108g',
                            '   P: 2g / G: 27g / L: 0g / 120 kcal',
                            '',
                            'ü•¶ Haricots verts + carottes',
                            '   CRU : 350g ‚Üí CUIT : 300g',
                            '   P: 7g / G: 21g / L: 1g / 120 kcal',
                            '',
                            'ü´í Huile d\'olive + beurre',
                            '   15ml huile + 10g beurre',
                            '   P: 0g / G: 0g / L: 23g / 207 kcal',
                            '',
                            'üçå Banane',
                            '   120g',
                            '   P: 1g / G: 27g / L: 0g / 110 kcal',
                            '',
                            'üåø Ajouts : Persil + Citron + Ail'
                        ]
                    },
                    {
                        id: 'E',
                        nom: 'VARIANTE 5 : DORADE + P√ÇTES + L√âGUMES M√âDITERRAN√âENS',
                        macros: {P: 77, G: 95, L: 42, kcal: 1043},
                        aliments: [
                            'üêü Dorade enti√®re (ou filet)',
                            '   CRU : 320g ‚Üí CUIT (filets) : 200g',
                            '   P: 46g / G: 0g / L: 9g / 273 kcal',
                            '',
                            'üçù P√¢tes compl√®tes',
                            '   CRU : 70g ‚Üí CUIT : 190g',
                            '   P: 9g / G: 56g / L: 2g / 280 kcal',
                            '',
                            'üçÖ L√©gumes m√©diterran√©ens',
                            '   (Tomates, courgettes, oignons, poivrons r√¥tis)',
                            '   CRU : 400g ‚Üí CUIT : 320g',
                            '   P: 8g / G: 24g / L: 1g / 135 kcal',
                            '',
                            'ü´í Huile d\'olive extra-vierge',
                            '   25ml',
                            '   P: 0g / G: 0g / L: 25g / 225 kcal',
                            '',
                            'ü•ú Amandes effil√©es (garniture)',
                            '   10g',
                            '   P: 2g / G: 2g / L: 5g / 62 kcal',
                            '',
                            'üí° +¬Ω banane 60g : G: +13g',
                            'üí° OU +15g whey pour prot√©ines',
                            'üåø Ajouts : Thym + Romarin + Ail + Citron'
                        ]
                    }
                ],
                supplements: [
                    'üíä MSM : 2000mg (2 g√©lules)',
                    'üíä Cr√©atine : 5g (dans eau/th√©)',
                    'üíä Collag√®ne : 10g (dans caf√©/th√© chaud)'
                ],
                antiInflammatoires: [
                    'üåø Curcuma frais : 5g (saupoudrer)',
                    'ü´ö Gingembre frais : 5g (r√¢per)',
                    'üßÑ Ail cru : 1 gousse (hacher, attendre 10 min)',
                    '‚ö´ Poivre noir : Pinc√©e (√ó2000 absorption curcuma)'
                ]
            },
            {
                id: 'repas2_training',
                nom: 'REPAS 2 - Post-Training',
                heure: '15:45',
                calories: 860,
                macros: {P: 62, G: 148, L: 5},
                note: '‚è∞ Dans les 30 min post-training MAX',
                aliments: [
                    'üí™ SHAKER ANTI-INFLAMMATOIRE :',
                    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
                    'üí™ Whey isolate nature : 60g',
                    'üçå Bananes m√ªres : 360g (3 moyennes)',
                    'ü•£ Flocons avoine : 40g secs',
                    'üçí Jus cerise acide : 150ml (Montmorency)',
                    'ü´ê Myrtilles surgel√©es : 100g',
                    'üçØ Miel : 10g (1 c. caf√©)',
                    'üíß Eau : 200ml + glace',
                    '',
                    'üîÑ MIXER 30 sec = Shake 1L',
                    '',
                    'üí∞ Co√ªt : ~2.80‚Ç¨'
                ]
            },
            {
                id: 'repas3_training',
                nom: 'REPAS 3 - Final',
                heure: '19:30',
                calories: 865,
                macros: {P: 81, G: 46, L: 43},
                note: 'üçΩÔ∏è Lun/Mer standard, Ven = Frites',
                options: [
                    {
                        id: 'A',
                        nom: 'VARIANTE 1 : POULET + PATATE DOUCE (Base)',
                        macros: {P: 81, G: 46, L: 43, kcal: 899},
                        aliments: [
                            'üçó Poulet blanc grill√©',
                            '   CRU : 300g ‚Üí CUIT : 240g',
                            '   P: 72g / G: 0g / L: 6g / 336 kcal',
                            '',
                            'ü•î Patate douce',
                            '   CRU : 140g ‚Üí CUIT : 126g',
                            '   P: 2g / G: 34g / L: 0g / 148 kcal',
                            '',
                            'ü•ó Salade verte + tomates + concombre',
                            '   300g',
                            '   P: 4g / G: 12g / L: 1g / 70 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   30ml',
                            '   P: 0g / G: 0g / L: 30g / 270 kcal',
                            '',
                            'üå∞ Graines de lin moulues',
                            '   15g',
                            '   P: 3g / G: 0g / L: 6g / 75 kcal',
                            '',
                            'üåø Ajouts : Curcuma + Gingembre + Ail'
                        ]
                    },
                    {
                        id: 'B',
                        nom: 'VARIANTE 2 : SAUMON + RIZ + AVOCAT',
                        macros: {P: 83, G: 48, L: 50, kcal: 965},
                        aliments: [
                            'üêü Saumon sauvage',
                            '   CRU : 300g ‚Üí CUIT : 240g',
                            '   P: 55g / G: 0g / L: 24g / 414 kcal',
                            '',
                            'üçö Riz basmati',
                            '   CRU : 35g ‚Üí CUIT : 105g',
                            '   P: 3g / G: 30g / L: 0g / 130 kcal',
                            '',
                            'ü•ë Avocat',
                            '   80g (¬Ω moyen)',
                            '   P: 2g / G: 7g / L: 11g / 128 kcal',
                            '',
                            'ü•ó Salade + l√©gumes crus',
                            '   300g',
                            '   P: 4g / G: 12g / L: 1g / 70 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   20ml',
                            '   P: 0g / G: 0g / L: 20g / 180 kcal',
                            '',
                            'üí° +50g poulet froid dans salade',
                            '   (P: +15g ajout√© ci-dessus)',
                            'üåø Ajouts : Coriandre + Citron + Ail'
                        ]
                    },
                    {
                        id: 'C',
                        nom: 'VARIANTE 3 : VIANDE HACH√âE + L√âGUMES + GALETTES RIZ',
                        macros: {P: 85, G: 52, L: 42, kcal: 908},
                        aliments: [
                            'ü•© Viande hach√©e 5%',
                            '   CRU : 300g ‚Üí CUIT : 240g',
                            '   P: 72g / G: 0g / L: 12g / 384 kcal',
                            '',
                            'üçÖ Ratatouille maison',
                            '   (Courgettes, aubergines, poivrons, tomates, oignon)',
                            '   400g',
                            '   P: 6g / G: 24g / L: 2g / 135 kcal',
                            '',
                            'üçò Galettes de riz',
                            '   30g (3-4 galettes)',
                            '   P: 2g / G: 24g / L: 1g / 112 kcal',
                            '',
                            'ü•ú Beurre de cacahu√®te',
                            '   20g (1 cuill√®re soupe rase)',
                            '   P: 5g / G: 4g / L: 12g / 142 kcal',
                            '',
                            'ü´í Huile d\'olive (cuisson ratatouille)',
                            '   15ml',
                            '   P: 0g / G: 0g / L: 15g / 135 kcal',
                            '',
                            'üí° Tartiner beurre cacahu√®te sur galettes riz',
                            'üåø Ajouts : Herbes de Provence + Ail'
                        ]
                    },
                    {
                        id: 'D',
                        nom: 'VARIANTE 4 : POISSON BLANC + QUINOA + L√âGUMES ASIATIQUES',
                        macros: {P: 85, G: 57, L: 39, kcal: 914},
                        aliments: [
                            'üêü Filet poisson blanc (colin, cabillaud)',
                            '   CRU : 350g ‚Üí CUIT : 280g',
                            '   P: 64g / G: 0g / L: 2g / 270 kcal',
                            '',
                            'üåæ Quinoa',
                            '   CRU : 45g ‚Üí CUIT : 135g',
                            '   P: 6g / G: 34g / L: 2g / 180 kcal',
                            '',
                            'ü•¶ L√©gumes asiatiques saut√©s',
                            '   (Pak choi, champignons, poivrons, oignons)',
                            '   CRU : 350g ‚Üí CUIT : 280g',
                            '   P: 8g / G: 18g / L: 1g / 115 kcal',
                            '',
                            'ü•ú Sauce cacahu√®te maison',
                            '   (15g beurre cacahu√®te + sauce soja + citron vert)',
                            '   P: 4g / G: 3g / L: 9g / 107 kcal',
                            '',
                            'ü´í Huile s√©same + olive (cuisson)',
                            '   20ml m√©lange',
                            '   P: 0g / G: 0g / L: 20g / 180 kcal',
                            '',
                            'ü•ú Cacahu√®tes concass√©es (garniture)',
                            '   10g',
                            '   P: 3g / G: 2g / L: 5g / 62 kcal',
                            '',
                            'üåø Ajouts : Gingembre frais + Ail + Coriandre + Citron vert'
                        ]
                    },
                    {
                        id: 'E',
                        nom: 'VARIANTE 5 : DORADE + P√ÇTES + PESTO MAISON',
                        macros: {P: 81, G: 51, L: 52, kcal: 1018},
                        aliments: [
                            'üêü Dorade grill√©e (filets)',
                            '   CRU : 450g ‚Üí CUIT : 283g',
                            '   P: 66g / G: 0g / L: 13g / 394 kcal',
                            '',
                            'üçù P√¢tes compl√®tes',
                            '   CRU : 45g ‚Üí CUIT : 125g',
                            '   P: 6g / G: 36g / L: 1g / 180 kcal',
                            '',
                            'üåø Pesto maison',
                            '   (Basilic 30g + huile olive 15ml + parmesan 10g + ail)',
                            '   P: 3g / G: 2g / L: 18g / 180 kcal',
                            '',
                            'üçÖ Tomates cerises r√¥ties',
                            '   200g',
                            '   P: 2g / G: 8g / L: 0g / 40 kcal',
                            '',
                            'ü•ó Roquette',
                            '   100g',
                            '   P: 3g / G: 4g / L: 1g / 35 kcal',
                            '',
                            'ü´í Huile d\'olive suppl√©mentaire',
                            '   15ml',
                            '   P: 0g / G: 0g / L: 15g / 135 kcal',
                            '',
                            'ü•ú Pignons de pin',
                            '   10g',
                            '   P: 1g / G: 1g / L: 7g / 71 kcal',
                            '',
                            'üåø Ajouts : Basilic frais + Ail + Citron'
                        ]
                    },
                    {
                        id: 'F',
                        nom: 'VARIANTE 6 : ≈íUFS + L√âGUMES + GALETTES (Option rapide)',
                        macros: {P: 87, G: 55, L: 40, kcal: 904},
                        aliments: [
                            'ü•ö Omelette 4 ≈ìufs entiers',
                            '   220g (4 ≈ìufs)',
                            '   P: 28g / G: 2g / L: 20g / 284 kcal',
                            '',
                            'üçó Blanc de poulet froid ajout√©',
                            '   CRU : 180g ‚Üí CUIT : 144g',
                            '   P: 43g / G: 0g / L: 4g / 203 kcal',
                            '',
                            'ü•¶ L√©gumes vapeur (brocoli, carottes)',
                            '   300g',
                            '   P: 9g / G: 18g / L: 1g / 115 kcal',
                            '',
                            'üçò Galettes de riz',
                            '   40g (4-5 galettes)',
                            '   P: 3g / G: 32g / L: 1g / 150 kcal',
                            '',
                            'ü•ú Beurre de cacahu√®te',
                            '   15g (sur galettes)',
                            '   P: 4g / G: 3g / L: 9g / 107 kcal',
                            '',
                            'ü´í Huile d\'olive (ajust√©e)',
                            '   5ml',
                            '   P: 0g / G: 0g / L: 5g / 45 kcal',
                            '',
                            'üí° Meal prep poulet + omelette express',
                            'üåø Ajouts : Herbes + Ail'
                        ]
                    },
                    {
                        id: 'G',
                        nom: 'üçü VENDREDI SOIR - REPAS FRITES VALID√â',
                        macros: {P: 68, G: 46, L: 36, kcal: 858},
                        aliments: [
                            '‚ö†Ô∏è ORDRE IMP√âRATIF :',
                            '',
                            '1Ô∏è‚É£ SALADE (EN PREMIER - crucial)',
                            'ü•ó Salade verte CRU : 200g',
                            '   P: 2g / G: 4g / L: 0g / 25 kcal',
                            'ü´í Huile olive 15ml : 135 kcal',
                            'üå∞ Graines lin 15g : 75 kcal',
                            '',
                            '2Ô∏è‚É£ VIANDE (DEUXI√àME)',
                            'ü•© Steak b≈ìuf 5% OU Poulet',
                            '   CRU : 250g ‚Üí CUIT : 200g',
                            '   P: 60g / G: 0g / L: 10g / 330 kcal',
                            '',
                            '3Ô∏è‚É£ FRITES (DERNIER - important)',
                            'üçü Frites maison Air Fryer',
                            '   Pommes de terre CRU : 200g ‚Üí CUITES : 170g',
                            '   + Spray huile olive 5ml',
                            '   P: 4g / G: 40g / L: 5g / 225 kcal',
                            '',
                            'ü•ú NOIX m√©lange (sati√©t√©)',
                            '   10g',
                            '   P: 2g / G: 2g / L: 6g / 68 kcal',
                            '',
                            'üí° R√©duit pic glyc√©mique -30-40% (crucial diab√®te)',
                            'üåø Ajouts : Curcuma + Ail'
                        ]
                    }
                ],
                supplements: [],
                antiInflammatoires: [
                    'üåø Curcuma : 3g',
                    'ü´ö Gingembre : 3g',
                    'üßÑ Ail : 1 gousse'
                ]
            }
        ],
        // üÜï Nouvelle structure pour suppl√©ments globaux
        supplementsGlobaux: [
            {
                moment: 'MATIN (7h30, √† jeun)',
                liste: [
                    '‚òï Caf√© noir : 1-2 tasses (300mg caf√©ine)',
                    'üíä Vitamine D3 : 5000 UI (1 capsule)',
                    'üíß Eau : 500ml'
                ]
            },
            {
                moment: 'PENDANT TRAINING (14h-15h30)',
                liste: [
                    '‚ö†Ô∏è PAS d\'intra-workout en s√®che',
                    'üíß Eau : 750ml-1L',
                    'üßÇ Sel : 1g (pinc√©e)',
                    'üíä Cr√©atine : 5g (si pas pris repas 1)'
                ]
            },
            {
                moment: 'SOIR (22h00, avant coucher)',
                liste: [
                    'üíä ARTICULATIONS :',
                    '‚Ä¢ Om√©ga-3 EPA/DHA : 4g (4 capsules)',
                    '  ‚Üí ‚ö†Ô∏è 2g seulement si saumon au d√Æner',
                    '‚Ä¢ Curcuma + Poivre noir : 1000mg + 20mg',
                    '‚Ä¢ Boswellia : 500mg (1 g√©lule)',
                    '‚Ä¢ Collag√®ne : 5g (eau chaude)',
                    '',
                    'üíä R√âCUP√âRATION :',
                    '‚Ä¢ Magn√©sium bisglycinate : 400mg',
                    '‚Ä¢ Zinc : 30mg',
                    '‚Ä¢ Vitamine C : 1000mg',
                    '‚Ä¢ Glycine : 5g (sommeil +15%)',
                    '',
                    'üíä DIAB√àTE (optionnel) :',
                    '‚Ä¢ Berb√©rine : 500mg (si glyc√©mie >1g/L)',
                    '‚Ä¢ Chrome picolinate : 200mcg',
                    '',
                    'üíß Eau : 500ml'
                ]
            }
        ]
    },
    repos: {
        repas: [
            {
                id: 'repas1_repos',
                nom: 'REPAS 1',
                heure: '12:00',
                calories: 940,
                macros: {P: 98, G: 67, L: 34},
                options: [
                    {
                        id: 'A',
                        nom: 'VARIANTE 1 : POULET + RIZ (Base)',
                        macros: {P: 98, G: 67, L: 34, kcal: 959},
                        aliments: [
                            'üçó Poulet blanc',
                            '   CRU : 350g ‚Üí CUIT : 280g',
                            '   P: 84g / G: 0g / L: 7g / 392 kcal',
                            '',
                            'üçö Riz basmati',
                            '   CRU : 55g ‚Üí CUIT : 165g',
                            '   P: 4g / G: 46g / L: 1g / 212 kcal',
                            '',
                            'ü•¶ L√©gumes',
                            '   CRU : 400g ‚Üí CUIT : 350g',
                            '   P: 10g / G: 21g / L: 1g / 130 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   25ml',
                            '   P: 0g / G: 0g / L: 25g / 225 kcal',
                            '',
                        ]
                    },
                    {
                        id: 'B',
                        nom: 'VARIANTE 2 : VIANDE HACH√âE + P√ÇTES',
                        macros: {P: 95, G: 58, L: 36, kcal: 925},
                        aliments: [
                            'ü•© Viande hach√©e 5%',
                            '   CRU : 350g ‚Üí CUIT : 280g',
                            '   P: 84g / G: 0g / L: 14g / 448 kcal',
                            '',
                            'üçù P√¢tes compl√®tes',
                            '   CRU : 50g ‚Üí CUIT : 135g',
                            '   P: 6g / G: 40g / L: 1g / 197 kcal',
                            '',
                            'üçÖ Sauce tomate + l√©gumes',
                            '   300g',
                            '   P: 5g / G: 18g / L: 1g / 100 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   20ml',
                            '   P: 0g / G: 0g / L: 20g / 180 kcal',
                            '',
                        ]
                    },
                    {
                        id: 'C',
                        nom: 'VARIANTE 3 : SAUMON + QUINOA',
                        macros: {P: 87, G: 62, L: 53, kcal: 1086},
                        aliments: [
                            'üêü Saumon sauvage',
                            '   CRU : 380g ‚Üí CUIT : 304g',
                            '   P: 70g / G: 0g / L: 36g / 594 kcal',
                            '',
                            'üåæ Quinoa',
                            '   CRU : 40g ‚Üí CUIT : 120g',
                            '   P: 6g / G: 30g / L: 2g / 162 kcal',
                            '',
                            'ü•¶ L√©gumes r√¥tis',
                            '   350g cuit',
                            '   P: 7g / G: 21g / L: 1g / 120 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   20ml',
                            '   P: 0g / G: 0g / L: 20g / 180 kcal',
                            '',
                            'ü•ú Amandes',
                            '   15g',
                            '   P: 3g / G: 3g / L: 8g / 94 kcal',
                            '',
                            'üí° R√©duire quinoa pour ajuster calories',
                        ]
                    },
                    {
                        id: 'D',
                        nom: 'VARIANTE 4 : POISSON BLANC + PATATE DOUCE',
                        macros: {P: 86, G: 63, L: 36, kcal: 915},
                        aliments: [
                            'üêü Filet poisson blanc',
                            '   CRU : 400g ‚Üí CUIT : 320g',
                            '   P: 73g / G: 0g / L: 3g / 312 kcal',
                            '',
                            'ü•î Patate douce',
                            '   CRU : 200g ‚Üí CUIT : 180g',
                            '   P: 4g / G: 45g / L: 0g / 200 kcal',
                            '',
                            'ü•¶ L√©gumes vapeur',
                            '   350g cuit',
                            '   P: 9g / G: 18g / L: 1g / 115 kcal',
                            '',
                            'ü´í Huile d\'olive + beurre',
                            '   20ml + 15g',
                            '   P: 0g / G: 0g / L: 32g / 288 kcal',
                            '',
                        ]
                    },
                    {
                        id: 'E',
                        nom: 'VARIANTE 5 : DORADE + RIZ + L√âGUMES',
                        macros: {P: 94, G: 64, L: 47, kcal: 1094},
                        aliments: [
                            'üêü Dorade (filets)',
                            '   CRU : 550g ‚Üí CUIT : 344g',
                            '   P: 80g / G: 0g / L: 15g / 470 kcal',
                            '',
                            'üçö Riz basmati',
                            '   CRU : 45g ‚Üí CUIT : 135g',
                            '   P: 3g / G: 38g / L: 1g / 173 kcal',
                            '',
                            'ü•¶ L√©gumes m√©diterran√©ens',
                            '   350g cuit',
                            '   P: 8g / G: 24g / L: 1g / 135 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   25ml',
                            '   P: 0g / G: 0g / L: 25g / 225 kcal',
                            '',
                            'ü•ú Noix',
                            '   15g',
                            '   P: 2g / G: 2g / L: 9g / 99 kcal',
                            '',
                            'üí° R√©duire riz si besoin ajuster',
                        ]
                    }
                ],
                supplements: [
                    'üíä MSM : 2000mg',
                    'üíä Cr√©atine : 5g',
                    'üíä Collag√®ne : 10g'
                ],
                antiInflammatoires: [
                    'üåø Curcuma : 5g',
                    'ü´ö Gingembre : 5g',
                    'üßÑ Ail : 1 gousse'
                ]
            },
            {
                id: 'repas2_repos',
                nom: 'COLLATION',
                heure: '16:00',
                calories: 484,
                macros: {P: 61, G: 35, L: 12},
                options: [
                    {
                        id: 'A',
                        nom: 'VARIANTE 1 : SKYR + WHEY + FRUITS (Base)',
                        macros: {P: 61, G: 35, L: 12, kcal: 484},
                        aliments: [
                            'üç∂ Skyr 0%',
                            '   300g',
                            '   P: 30g / G: 12g / L: 0g / 168 kcal',
                            '',
                            'üí™ Whey isolate',
                            '   30g',
                            '   P: 26g / G: 1g / L: 1g / 116 kcal',
                            '',
                            'üçå Banane',
                            '   80g (petite)',
                            '   P: 1g / G: 18g / L: 0g / 75 kcal',
                            '',
                            'ü•ú Amandes',
                            '   20g',
                            '   P: 4g / G: 4g / L: 11g / 125 kcal',
                            '',
                        ]
                    },
                    {
                        id: 'B',
                        nom: 'VARIANTE 2 : GALETTES RIZ + BEURRE CACAHU√àTE + FRUITS ‚≠ê',
                        macros: {P: 55, G: 56, L: 13, kcal: 549},
                        aliments: [
                            'üçò Galettes de riz',
                            '   40g (4-5 galettes)',
                            '   P: 3g / G: 32g / L: 1g / 150 kcal',
                            '',
                            'ü•ú Beurre de cacahu√®te',
                            '   20g (r√©duit)',
                            '   P: 5g / G: 4g / L: 12g / 142 kcal',
                            '',
                            'üí™ Whey isolate',
                            '   40g',
                            '   P: 34g / G: 1g / L: 1g / 148 kcal',
                            '',
                            'üçé Pomme',
                            '   120g (coup√©e en tranches pour tartiner)',
                            '   P: 1g / G: 16g / L: 0g / 65 kcal',
                            '',
                            'üç∂ Skyr 0% (√† c√¥t√©)',
                            '   100g',
                            '   P: 10g / G: 4g / L: 0g / 56 kcal',
                            '',
                            'üí° Tartiner beurre cacahu√®te sur galettes',
                            'üí° Whey dans eau s√©par√©',
                        ]
                    },
                    {
                        id: 'C',
                        nom: 'VARIANTE 3 : FROMAGE BLANC + FRUITS + NOIX',
                        macros: {P: 63, G: 41, L: 10, kcal: 498},
                        aliments: [
                            'ü•õ Fromage blanc 0%',
                            '   300g',
                            '   P: 24g / G: 12g / L: 0g / 144 kcal',
                            '',
                            'üí™ Whey chocolat (m√©lang√© dedans)',
                            '   40g',
                            '   P: 34g / G: 2g / L: 1g / 152 kcal',
                            '',
                            'üçì Fruits rouges surgel√©s',
                            '   100g (fraises, myrtilles)',
                            '   P: 1g / G: 12g / L: 0g / 50 kcal',
                            '',
                            'ü•ú Noix de cajou',
                            '   20g',
                            '   P: 4g / G: 7g / L: 9g / 122 kcal',
                            '',
                            'üçØ Miel',
                            '   10g',
                            '   P: 0g / G: 8g / L: 0g / 30 kcal',
                            '',
                            'üí° M√©langer fromage blanc + whey chocolat',
                            'üí° Ajouter fruits rouges + noix + miel',
                        ]
                    },
                    {
                        id: 'D',
                        nom: 'VARIANTE 4 : ≈íUFS DURS + PAIN COMPLET + AVOCAT',
                        macros: {P: 51, G: 27, L: 36, kcal: 629},
                        aliments: [
                            'ü•ö ≈íufs durs',
                            '   4 ≈ìufs (200g)',
                            '   P: 25g / G: 1g / L: 20g / 284 kcal',
                            '',
                            'üçû Pain complet',
                            '   40g (1.5 tranche)',
                            '   P: 4g / G: 19g / L: 2g / 106 kcal',
                            '',
                            'ü•ë Avocat',
                            '   40g (¬º)',
                            '   P: 1g / G: 3g / L: 6g / 64 kcal',
                            '',
                            'ü•ú Amandes',
                            '   15g',
                            '   P: 3g / G: 3g / L: 8g / 94 kcal',
                            '',
                            'üí™ Whey',
                            '   20g',
                            '   P: 17g / G: 1g / L: 1g / 78 kcal',
                            '',
                            'üí° Option difficile √† √©quilibrer',
                            'üí° Privil√©gier autres variantes',
                        ]
                    },
                    {
                        id: 'E',
                        nom: 'VARIANTE 5 : SMOOTHIE PROT√âIN√â COMPLET',
                        macros: {P: 61, G: 43, L: 14, kcal: 539},
                        aliments: [
                            'üí™ Whey vanille',
                            '   60g',
                            '   P: 51g / G: 3g / L: 2g / 228 kcal',
                            '',
                            'üçå Banane',
                            '   100g',
                            '   P: 1g / G: 23g / L: 0g / 95 kcal',
                            '',
                            'ü•ú Beurre de cacahu√®te',
                            '   15g',
                            '   P: 4g / G: 3g / L: 9g / 107 kcal',
                            '',
                            'ü•õ Lait d\'amande non sucr√©',
                            '   200ml',
                            '   P: 2g / G: 2g / L: 2g / 34 kcal',
                            '',
                            'ü•£ Flocons d\'avoine',
                            '   20g',
                            '   P: 3g / G: 12g / L: 1g / 75 kcal',
                            '',
                            'üí° Blender : Tout mixer avec glace',
                            'üí° Collation liquide compl√®te',
                        ]
                    }
                ]
            },
            {
                id: 'repas3_repos',
                nom: 'REPAS 3 - Soir',
                heure: '19:30',
                calories: 720,
                macros: {P: 49, G: 28, L: 54},
                note: 'üçΩÔ∏è Rotation prot√©ines selon jour',
                options: [
                    {
                        id: 'A',
                        nom: 'VARIANTE 1 : SAUMON + PATATE DOUCE (Base)',
                        macros: {P: 49, G: 28, L: 54, kcal: 785},
                        aliments: [
                            'üêü Saumon sauvage',
                            '   CRU : 220g ‚Üí CUIT : 176g',
                            '   P: 40g / G: 0g / L: 17g / 297 kcal',
                            '',
                            'ü•î Patate douce',
                            '   CRU : 60g ‚Üí CUIT : 54g',
                            '   P: 1g / G: 13g / L: 0g / 58 kcal',
                            '',
                            'ü•ó Salade + l√©gumes crus',
                            '   350g',
                            '   P: 5g / G: 15g / L: 1g / 85 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   30ml',
                            '   P: 0g / G: 0g / L: 30g / 270 kcal',
                            '',
                            'üå∞ Graines de lin',
                            '   15g',
                            '   P: 3g / G: 0g / L: 6g / 75 kcal',
                            '',
                        ]
                    },
                    {
                        id: 'B',
                        nom: 'VARIANTE 2 : DORADE + QUINOA + L√âGUMES',
                        macros: {P: 56, G: 41, L: 43, kcal: 770},
                        aliments: [
                            'üêü Dorade grill√©e',
                            '   CRU : 300g ‚Üí CUIT : 188g',
                            '   P: 43g / G: 0g / L: 10g / 263 kcal',
                            '',
                            'üåæ Quinoa',
                            '   CRU : 30g ‚Üí CUIT : 90g',
                            '   P: 4g / G: 23g / L: 2g / 122 kcal',
                            '',
                            'ü•¶ L√©gumes vapeur',
                            '   350g cuit',
                            '   P: 9g / G: 18g / L: 1g / 115 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   30ml',
                            '   P: 0g / G: 0g / L: 30g / 270 kcal',
                            '',
                        ]
                    },
                    {
                        id: 'C',
                        nom: 'VARIANTE 3 : POULET + GALETTES RIZ + BEURRE CACAHU√àTE ‚≠ê',
                        macros: {P: 61, G: 49, L: 41, kcal: 802},
                        aliments: [
                            'üçó Poulet blanc',
                            '   CRU : 200g ‚Üí CUIT : 160g',
                            '   P: 48g / G: 0g / L: 4g / 224 kcal',
                            '',
                            'üçò Galettes de riz',
                            '   40g (4-5 galettes)',
                            '   P: 3g / G: 32g / L: 1g / 150 kcal',
                            '',
                            'ü•ú Beurre de cacahu√®te',
                            '   25g (sur galettes)',
                            '   P: 6g / G: 5g / L: 15g / 178 kcal',
                            '',
                            'ü•ó Salade compos√©e',
                            '   300g (laitue, tomates, concombre, carottes)',
                            '   P: 4g / G: 12g / L: 1g / 70 kcal',
                            '',
                            'ü´í Huile d\'olive (salade)',
                            '   20ml',
                            '   P: 0g / G: 0g / L: 20g / 180 kcal',
                            '',
                            'üí° Poulet grill√© √©pic√©',
                            'üí° Galettes riz tartin√©es beurre cacahu√®te en "dessert sal√©"',
                        ]
                    },
                    {
                        id: 'D',
                        nom: 'VARIANTE 4 : POISSON BLANC + RIZ + AVOCAT',
                        macros: {P: 58, G: 54, L: 39, kcal: 784},
                        aliments: [
                            'üêü Filet colin/cabillaud',
                            '   CRU : 250g ‚Üí CUIT : 200g',
                            '   P: 46g / G: 0g / L: 2g / 197 kcal',
                            '',
                            'üçö Riz basmati',
                            '   CRU : 35g ‚Üí CUIT : 105g',
                            '   P: 3g / G: 29g / L: 0g / 129 kcal',
                            '',
                            'ü•ë Avocat',
                            '   80g (¬Ω)',
                            '   P: 2g / G: 7g / L: 11g / 128 kcal',
                            '',
                            'ü•¶ L√©gumes',
                            '   300g cuit',
                            '   P: 7g / G: 18g / L: 1g / 105 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   25ml',
                            '   P: 0g / G: 0g / L: 25g / 225 kcal',
                            '',
                        ]
                    },
                    {
                        id: 'E',
                        nom: 'VARIANTE 5 : ≈íUFS + L√âGUMES + PAIN (Rapide)',
                        macros: {P: 67, G: 37, L: 40, kcal: 763},
                        aliments: [
                            'ü•ö Omelette 3 ≈ìufs',
                            '   165g',
                            '   P: 21g / G: 2g / L: 15g / 214 kcal',
                            '',
                            'üçó Blanc dinde/poulet froid',
                            '   CRU : 150g ‚Üí CUIT : 120g',
                            '   P: 36g / G: 0g / L: 3g / 169 kcal',
                            '',
                            'ü•¶ L√©gumes r√¥tis',
                            '   350g cuit',
                            '   P: 7g / G: 21g / L: 1g / 120 kcal',
                            '',
                            'üçû Pain complet',
                            '   30g (1 tranche)',
                            '   P: 3g / G: 14g / L: 1g / 80 kcal',
                            '',
                            'ü´í Huile d\'olive',
                            '   20ml',
                            '   P: 0g / G: 0g / L: 20g / 180 kcal',
                            '',
                            'üí° Meal prep : Poulet/dinde cuit d\'avance',
                            'üí° Omelette express (5 min)',
                        ]
                    }
                ],
                supplements: [
                    'üíß BOUILLON OS (3-4√ó/sem) :',
                    '‚Ä¢ 250ml apr√®s repas',
                    '‚Ä¢ P: 10g / Collag√®ne naturel'
                ],
                antiInflammatoires: [
                    'üåø Curcuma : 3g',
                    'ü´ö Gingembre : 3g',
                    'üßÑ Ail : 1 gousse'
                ]
            }
        ],
        supplementsGlobaux: [
            {
                moment: 'MATIN (7h30, √† jeun)',
                liste: [
                    '‚òï Caf√© noir',
                    'üíä Vitamine D3 : 5000 UI',
                    'üíß Eau : 500ml'
                ]
            },
            {
                moment: 'SOIR (22h00)',
                liste: [
                    'üíä Om√©ga-3 : 2g (si saumon) ou 4g',
                    'üíä Curcuma + Poivre : 1000mg',
                    'üíä Boswellia : 500mg',
                    'üíä Collag√®ne : 5g',
                    'üíä Magn√©sium : 400mg',
                    'üíä Zinc : 30mg',
                    'üíä Vitamine C : 1000mg',
                    'üíä Glycine : 5g'
                ]
            }
        ]
    }
};

// üÜï D√âTAILS NUTRITIONNELS COMPLETS PAR ALIMENT
const DETAILS_NUTRITIONNELS = {
    training: {
        repas1: {
            cout: '~2.50‚Ç¨',
            total: {P: 78, G: 141, L: 22, kcal: 1060},
            aliments: {
                poulet_250g: {P: 60, G: 0, L: 5, kcal: 280},
                riz_90g: {P: 7, G: 76, L: 1, kcal: 340},
                legumes_350g: {P: 9, G: 18, L: 1, kcal: 115},
                huile_15ml: {P: 0, G: 0, L: 15, kcal: 135},
                banane_120g: {P: 1, G: 27, L: 0, kcal: 110},
                pomme_150g: {P: 1, G: 20, L: 0, kcal: 80}
            }
        },
        repas2: {
            cout: '~2.80‚Ç¨',
            total: {P: 62, G: 148, L: 5, kcal: 860},
            aliments: {
                whey_60g: {P: 51, G: 3, L: 1, kcal: 220},
                bananes_360g: {P: 4, G: 81, L: 1, kcal: 330},
                flocons_40g: {P: 5, G: 24, L: 3, kcal: 150},
                jus_cerise_150ml: {P: 1, G: 20, L: 0, kcal: 80},
                myrtilles_100g: {P: 1, G: 12, L: 0, kcal: 50},
                miel_10g: {P: 0, G: 8, L: 0, kcal: 30}
            }
        },
        repas3: {
            cout: '~3.50‚Ç¨',
            total: {P: 46, G: 54, L: 34, kcal: 715},
            aliments: {
                saumon_180g: {P: 35, G: 0, L: 12, kcal: 250},
                riz_50g: {P: 4, G: 42, L: 0, kcal: 185},
                salade_300g: {P: 4, G: 12, L: 1, kcal: 70},
                huile_15ml: {P: 0, G: 0, L: 15, kcal: 135},
                graines_lin_15g: {P: 3, G: 0, L: 6, kcal: 75}
            }
        },
        repas3_vendredi: {
            cout: '~2.50‚Ç¨',
            total: {P: 73, G: 76, L: 30, kcal: 875},
            aliments: {
                salade_200g: {P: 2, G: 4, L: 0, kcal: 25},
                viande_250g: {P: 60, G: 0, L: 8, kcal: 320},
                frites_350g: {P: 8, G: 70, L: 10, kcal: 390},
                huile_10ml: {P: 0, G: 0, L: 10, kcal: 90},
                graines_lin_15g: {P: 3, G: 0, L: 6, kcal: 75}
            },
            note: '‚ö†Ô∏è SURPLUS +160 kcal ‚Üí Compenser Lun/Mer (-80 kcal chaque)'
        }
    },
    repos: {
        repas1: {
            cout: '~2.30‚Ç¨',
            total: {P: 76, G: 100, L: 27, kcal: 935},
            aliments: {
                poulet_250g: {P: 60, G: 0, L: 5, kcal: 280},
                riz_70g: {P: 5, G: 59, L: 1, kcal: 265},
                legumes_400g: {P: 10, G: 21, L: 1, kcal: 130},
                huile_20ml: {P: 0, G: 0, L: 20, kcal: 180},
                pomme_150g: {P: 1, G: 20, L: 0, kcal: 80}
            }
        },
        collation: {
            cout: '~1.80‚Ç¨',
            total: {P: 30, G: 49, L: 11, kcal: 405}
        },
        repas3: {
            cout: '~3.20‚Ç¨',
            total: {P: 47, G: 55, L: 39, kcal: 765}
        }
    }
};

// üÜï OPTIONS AJUSTEMENT MACROS (si plateau perte poids)
const AJUSTEMENTS_MACROS = {
    training: {
        optionA: {
            nom: 'Option A - √âquilibr√© (Recommand√©)',
            description: 'Ajustements l√©gers pour approcher objectifs',
            repas1: {
                modifications: [
                    'üçó Poulet : 300g cru ‚Üí 240g cuit (+20g prot√©ines)',
                    'üçö Riz : 80g cru ‚Üí 240g cuit (-8g glucides)',
                    'Reste inchang√©'
                ],
                macros: {P: 90, G: 125, L: 22, kcal: 1050}
            },
            repas2: {
                modifications: ['Inchang√©'],
                macros: {P: 62, G: 148, L: 5, kcal: 860}
            },
            repas3: {
                modifications: [
                    'üêü Saumon : 200g cru ‚Üí 160g cuit (+3g prot√©ines)',
                    'üçö Riz : 40g cru ‚Üí 120g cuit (-8g glucides)',
                    'Reste inchang√©'
                ],
                macros: {P: 48, G: 48, L: 35, kcal: 685}
            },
            total: {P: 200, G: 321, L: 62, kcal: 2595},
            note: '‚úÖ Proche objectifs, bon compromis sati√©t√©/performance'
        },
        optionB: {
            nom: 'Option B - Strict Macros (Si plateau)',
            description: 'Ajustements stricts pour respecter EXACTEMENT macros',
            repas1: {
                modifications: [
                    'üçó Poulet : 300g cru ‚Üí 240g cuit',
                    'üçö Riz : 70g cru ‚Üí 210g cuit (-17g glucides)',
                    'ü´í Huile : 10ml (-5ml = -5g lipides)',
                    'üçå Banane : SUPPRIM√âE (-27g glucides)'
                ],
                macros: {P: 90, G: 114, L: 17, kcal: 945}
            },
            repas2: {
                modifications: [
                    'üçå Bananes : 2 au lieu de 3 (-27g glucides)',
                    'ü•£ Flocons : 30g au lieu 40g (-6g glucides)',
                    'Reste inchang√©'
                ],
                macros: {P: 62, G: 107, L: 4, kcal: 700}
            },
            repas3: {
                modifications: [
                    'üêü Saumon : 200g cru (+3g prot√©ines)',
                    'üçö Riz : SUPPRIM√â (-42g glucides)',
                    'üç† Patate douce : 150g (+30g glucides)',
                    'ü´í Huile : 20ml (+5ml = +5g lipides)'
                ],
                macros: {P: 50, G: 42, L: 48, kcal: 740}
            },
            total: {P: 202, G: 263, L: 69, kcal: 2385},
            note: '‚ö†Ô∏è Plus restrictif, utiliser SI perte stagne >2 semaines'
        }
    }
};

// üÜï STACK SUPPL√âMENTS COMPLET AVEC CO√õTS ET B√âN√âFICES DIAB√àTE
// üÜï STACK SIMPLIFI√â - 8 SUPPL√âMENTS ESSENTIELS AVEC TIMING OPTIMIS√â
const STACK_SUPPLEMENTS_COMPLET = {
    liste_complete: {
        berberine: {
            nom: 'Berb√©rine',
            emoji: 'ü©∏',
            objectif: 'Diab√®te / Glyc√©mie',
            dose: '500mg',
            prix: '15‚Ç¨/mois',
            effet: 'Glyc√©mie -20%, Insuline +30%',
            timing: {
                training: [
                    {moment: 'REPAS 1 (12h00)', dose: '500mg (avec repas)'},
                    {moment: 'REPAS 3 (19h30)', dose: '500mg (avec repas)'}
                ],
                repos: [
                    {moment: 'REPAS 1 (12h00)', dose: '500mg (avec repas)'},
                    {moment: 'REPAS 3 (19h30)', dose: '500mg (avec repas)'}
                ]
            }
        },
        omega3: {
            nom: 'Om√©ga-3 EPA/DHA',
            emoji: 'üêü',
            objectif: 'Inflammation / Cardio',
            dose: '2-4g/jour',
            prix: '20‚Ç¨/mois',
            effet: 'Anti-inflammatoire, sant√© cardiovasculaire',
            timing: {
                training: [
                    {moment: 'SOIR (22h00)', dose: '4g (4 capsules)', note: '‚ö†Ô∏è 2g si saumon au d√Æner'}
                ],
                repos: [
                    {moment: 'SOIR (22h00)', dose: '4g (4 capsules)', note: '‚ö†Ô∏è 2g si saumon/poisson gras au d√Æner'}
                ]
            }
        },
        collagene: {
            nom: 'Collag√®ne',
            emoji: 'ü¶¥',
            objectif: 'Articulations / Tendons',
            dose: '15g/jour',
            prix: '25‚Ç¨/mois',
            effet: 'Sant√© articulations, tendons, peau',
            timing: {
                training: [
                    {moment: 'REPAS 1 (12h00)', dose: '10g (dans caf√©/th√© chaud)'},
                    {moment: 'SOIR (22h00)', dose: '5g (dans eau chaude)'}
                ],
                repos: [
                    {moment: 'REPAS 1 (12h00)', dose: '10g (dans caf√©/th√© chaud)'},
                    {moment: 'SOIR (22h00)', dose: '5g (dans eau chaude)'}
                ]
            }
        },
        creatine: {
            nom: 'Cr√©atine',
            emoji: 'üí™',
            objectif: 'Performance / Force',
            dose: '5g/jour',
            prix: '8‚Ç¨/mois',
            effet: 'Force +10-15%, r√©cup√©ration musculaire',
            timing: {
                training: [
                    {moment: 'REPAS 1 (12h00)', dose: '5g (dans eau/th√©)', note: 'Avant training'}
                ],
                repos: [
                    {moment: 'MATIN (7h30)', dose: '5g (dans eau/caf√©)', note: '√Ä jeun ou avec petit d√©jeuner'}
                ]
            }
        },
        vitamine_d3: {
            nom: 'Vitamine D3',
            emoji: '‚òÄÔ∏è',
            objectif: 'Hormones / Immunit√©',
            dose: '5000 UI/jour',
            prix: '8‚Ç¨/mois',
            effet: 'Testost√©rone, immunit√©, sant√© osseuse',
            timing: {
                training: [
                    {moment: 'MATIN (7h30, √† jeun)', dose: '5000 UI (1 capsule)'}
                ],
                repos: [
                    {moment: 'MATIN (7h30, √† jeun)', dose: '5000 UI (1 capsule)'}
                ]
            }
        },
        magnesium: {
            nom: 'Magn√©sium Bisglycinate',
            emoji: 'üò¥',
            objectif: 'Sommeil / Insuline',
            dose: '400mg/jour',
            prix: '10‚Ç¨/mois',
            effet: 'Sommeil, relaxation, sensibilit√© insuline +30%',
            timing: {
                training: [
                    {moment: 'SOIR (22h00, avant coucher)', dose: '400mg'}
                ],
                repos: [
                    {moment: 'SOIR (22h00, avant coucher)', dose: '400mg'}
                ]
            }
        },
        msm: {
            nom: 'MSM',
            emoji: 'ü¶¥',
            objectif: 'Articulations / Anti-inflammatoire',
            dose: '2000mg/jour',
            prix: '10‚Ç¨/mois',
            effet: 'Inflammation -82%, soufre pour cartilages',
            timing: {
                training: [
                    {moment: 'REPAS 1 (12h00)', dose: '2000mg (2 g√©lules avec repas)'}
                ],
                repos: [
                    {moment: 'REPAS 1 (12h00)', dose: '2000mg (2 g√©lules avec repas)'}
                ]
            }
        },
        whey: {
            nom: 'Whey Isolate',
            emoji: 'ü•§',
            objectif: 'Prot√©ines / R√©cup√©ration',
            dose: '60-90g/jour (selon objectif)',
            prix: '40‚Ç¨/mois',
            effet: 'Apport prot√©ique optimis√©, r√©cup√©ration musculaire',
            timing: {
                training: [
                    {moment: 'POST-TRAINING (15h45)', dose: '60g (shaker anti-inflammatoire)'}
                ],
                repos: [
                    {moment: 'COLLATION (16h00)', dose: '30-40g (selon variante choisie)', note: 'Voir variantes collations'}
                ]
            }
        }
    },
    cout_total: {
        mensuel: '136‚Ç¨/mois',
        journalier: '~4.50‚Ç¨/jour',
        note: 'Stack simplifi√© et optimis√© - 8 suppl√©ments essentiels'
    }
};

function getSaison(){const mois=new Date().getMonth()+1;for(const[key,saison]of Object.entries(SAISONS)){if(saison.mois.includes(mois))return saison}return SAISONS.automne}
let SAISON_ACTUELLE=getSaison();

let semaineActuelle = 'S1';
let jourType = 'training';
let grignotages = [];
let pesees = JSON.parse(localStorage.getItem('pesees-hebdo') || '[]');
let derniereDateChargee = new Date().toISOString().split('T')[0];
let derniereSemaineChargee = 'S1';
let optionsSelectionnees = JSON.parse(localStorage.getItem('options-repas') || '{}');

window.onload = function() {
    updateSeasonDisplay();

    // üÜï Charger semaine sauvegard√©e (priorit√©) ou calculer selon date
    const savedSemaine = localStorage.getItem('semaineActuelle');
    if (savedSemaine && savedSemaine.match(/^S([1-9]|10)$/)) {
        semaineActuelle = savedSemaine;
    } else {
        semaineActuelle = getSemaineActuelle();
        localStorage.setItem('semaineActuelle', semaineActuelle);
    }

    derniereSemaineChargee = semaineActuelle;
    derniereDateChargee = new Date().toISOString().split('T')[0];
    loadDayType();
    updateTimelineVisuel();  // üÜï Mettre √† jour la timeline visuelle
    afficherMenu();
    loadGrignotages();
    calculerProgression();
    afficherSaison();
    afficherCarteSemaine();
    afficherGraphiquePoids();
    afficherHistoriquePesees();
    afficherAlertes();
    updateTimelineVisuel();
    
    setInterval(verifierChangementDate, 60000);
    verifierEtNotifierChangementSemaine();
    verifierBackupHebdomadaire();
};

function verifierBackupHebdomadaire() {
    const lastBackup = localStorage.getItem('last-backup');
    const aujourdhui = new Date();
    const jourSemaine = aujourdhui.getDay();
    
    if (jourSemaine === 0) {
        if (!lastBackup) {
            rappelBackup('Tu n\'as jamais fait de backup ! üíæ');
        } else {
            const dateLastBackup = new Date(lastBackup);
            const diffJours = Math.floor((aujourdhui - dateLastBackup) / (1000 * 60 * 60 * 24));
            
            if (diffJours >= 7) {
                rappelBackup(`Dernier backup il y a ${diffJours} jours ! üìÖ`);
            }
        }
    }
}

function rappelBackup(message) {
    const lastNotif = localStorage.getItem('derniere-notif-backup');
    const today = new Date().toISOString().split('T')[0];
    
    if (lastNotif === today) return;
    
    setTimeout(() => {
        const notification = document.createElement('div');
        notification.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 4000; max-width: 400px; text-align: center; animation: modalPop 0.5s;';
        notification.innerHTML = `
            <div style="font-size: 48px; margin-bottom: 15px;">üíæ</div>
            <h3 style="color: #667eea; margin-bottom: 10px;">Rappel Backup Hebdomadaire</h3>
            <p style="color: #666; margin-bottom: 20px;">${message}<br><small>Prot√®ge tes donn√©es avec un backup !</small></p>
            <button onclick="this.parentElement.remove(); document.querySelector('.tab[onclick*=export]').click(); setTimeout(() => telechargerBackup(), 500);" style="background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-right: 10px;">üíæ Faire backup</button>
            <button onclick="this.parentElement.remove();" style="background: #f0f0f0; color: #666; border: none; padding: 12px 24px; border-radius: 10px; font-weight: bold; cursor: pointer;">Plus tard</button>
        `;
        document.body.appendChild(notification);
        
        const overlay = document.createElement('div');
        overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3999;';
        overlay.onclick = () => {
            notification.remove();
            overlay.remove();
        };
        document.body.appendChild(overlay);
        
        localStorage.setItem('derniere-notif-backup', today);
    }, 3000);
}

function verifierChangementDate() {
    const dateActuelle = new Date().toISOString().split('T')[0];
    const semaineActuelle_check = getSemaineActuelle();
    
    if (dateActuelle !== derniereDateChargee) {
        derniereDateChargee = dateActuelle;
        afficherMenu();
        loadGrignotages();
        calculerProgression();
    }
    
    if (semaineActuelle_check !== derniereSemaineChargee) {
        derniereSemaineChargee = semaineActuelle_check;
        semaineActuelle = semaineActuelle_check;
        afficherMenu();
        afficherCarteSemaine();
        updateTimelineVisuel();
        calculerProgression();
    }
}

function verifierEtNotifierChangementSemaine() {
    const peseesSemaine = pesees.filter(p => p.semaine === semaineActuelle);
    const aujourdhui = new Date();
    const jourSemaine = aujourdhui.getDay();
    
    if ((jourSemaine === 5 || jourSemaine === 6) && peseesSemaine.length === 0) {
        const lastNotif = localStorage.getItem('derniere-notif-pesee');
        const today = new Date().toISOString().split('T')[0];
        
        if (lastNotif !== today) {
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 4000; max-width: 400px; text-align: center; animation: modalPop 0.5s;';
                notification.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 15px;">‚öñÔ∏è</div>
                    <h3 style="color: #667eea; margin-bottom: 10px;">Rappel Pes√©e Hebdomadaire</h3>
                    <p style="color: #666; margin-bottom: 20px;">C'est le moment id√©al pour te peser !<br><small>Vendredi/Samedi matin, √† jeun, apr√®s toilettes</small></p>
                    <button onclick="this.parentElement.remove(); ouvrirFormulairePesee();" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-right: 10px;">‚öñÔ∏è Faire ma pes√©e</button>
                    <button onclick="this.parentElement.remove();" style="background: #f0f0f0; color: #666; border: none; padding: 12px 24px; border-radius: 10px; font-weight: bold; cursor: pointer;">Plus tard</button>
                `;
                document.body.appendChild(notification);
                
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3999;';
                overlay.onclick = () => {
                    notification.remove();
                    overlay.remove();
                };
                document.body.appendChild(overlay);
                
                localStorage.setItem('derniere-notif-pesee', today);
            }, 2000);
        }
    }
}

// üÜï Fonction semaine actuelle √©tendue √† 10 semaines
function getSemaineActuelle() {
    const dateDebut = new Date(PLAN_HYBRIDE.dateDebut);
    const aujourdhui = new Date();
    const diffJours = Math.floor((aujourdhui - dateDebut) / (1000*60*60*24));
    const numSemaine = Math.floor(diffJours / 7) + 1;
    const semaine = 'S' + (numSemaine > 10 ? 10 : numSemaine < 1 ? 1 : numSemaine);
    return semaine;
}

function updateSeasonDisplay() {
    SAISON_ACTUELLE = getSaison();
    document.getElementById('season-badge').textContent = SAISON_ACTUELLE.emoji + ' ' + SAISON_ACTUELLE.nom.toUpperCase();
    document.getElementById('season-name-detail').textContent = SAISON_ACTUELLE.nom;
}

function afficherSaison() {
    const fruitsHTML = SAISON_ACTUELLE.fruits.map(f => `<span style="background: #fff9e6; padding: 8px 12px; border-radius: 8px; font-size: 13px; font-weight: bold;">üçé ${f}</span>`).join('');
    const legumesHTML = SAISON_ACTUELLE.legumes.map(l => `<span style="background: #e8f5e9; padding: 8px 12px; border-radius: 8px; font-size: 13px; font-weight: bold;">ü•¶ ${l}</span>`).join('');
    document.getElementById('fruits-saison').innerHTML = fruitsHTML;
    document.getElementById('legumes-saison').innerHTML = legumesHTML;
}

function setDayType(type) {
    jourType = type;
    localStorage.setItem('jourType', type);
    document.getElementById('day-display').textContent = type === 'training' ? 'üèãÔ∏è JOUR TRAINING' : 'üí§ JOUR REPOS';
    
    const menu = MENUS_BASE[type];
    const config = PLAN_HYBRIDE.semaines[semaineActuelle];
    
    document.getElementById('cal-total').textContent = config.calories[type];
    document.getElementById('prot-total').textContent = config.macros[type].P;
    document.getElementById('gluc-total').textContent = config.macros[type].G;
    document.getElementById('lip-total').textContent = config.macros[type].L;
    
    afficherMenu();
    calculerProgression();
    showAutoSave();
}

function loadDayType() {
    const saved = localStorage.getItem('jourType');
    if (saved) jourType = saved;
    document.getElementById('day-display').textContent = jourType === 'training' ? 'üèãÔ∏è JOUR TRAINING' : 'üí§ JOUR REPOS';
}

// üÜï Fonction affichage menu MODIFI√âE avec suppl√©ments et anti-inflammatoires
function afficherMenu() {
    const menu = MENUS_BASE[jourType];
    const config = PLAN_HYBRIDE.semaines[semaineActuelle];

    document.getElementById('semaine-actuelle-label').textContent = `${semaineActuelle} - ${config.nom.toUpperCase()}`;

    let html = '';

    // üÜï Conseil expert du jour
    const conseilsExperts = {
        training: [
            "üí™ <strong>Focus training :</strong> Glucides autour de l'entra√Ænement pour maximiser la performance et la r√©cup√©ration.",
            "üèãÔ∏è <strong>Astuce pro :</strong> Prendre la Cr√©atine le matin am√©liore la saturation musculaire progressive.",
            "‚ö° <strong>Performance :</strong> Le pic d'insuline post-training avec glucides rapides favorise l'anabolisme.",
            "üî• <strong>Astuce :</strong> MSM + Collag√®ne au repas 1 prot√®gent les articulations pendant la s√®che intensive."
        ],
        repos: [
            "üò¥ <strong>R√©cup√©ration :</strong> Le repos est aussi important que l'entra√Ænement pour la perte de graisse.",
            "üßò <strong>Astuce pro :</strong> Magn√©sium le soir am√©liore sommeil et sensibilit√© √† l'insuline.",
            "üåø <strong>Focus :</strong> Profitez du jour de repos pour optimiser votre hydratation (3-4L d'eau).",
            "üíö <strong>Conseil :</strong> Les jours de repos favorisent la r√©paration musculaire et la r√©cup√©ration hormonale."
        ]
    };

    const dayOfWeek = new Date().getDay();
    const conseilIndex = dayOfWeek % conseilsExperts[jourType].length;
    const conseilDuJour = conseilsExperts[jourType][conseilIndex];

    html += `<div class="alert-box alert-success" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left: 5px solid #51cf66; margin-bottom: 20px; animation: slideIn 0.5s;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="font-size: 32px;">üí°</div>
            <div style="flex: 1;">
                <div style="font-size: 11px; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;">Conseil Expert du Jour</div>
                <div style="font-size: 14px; line-height: 1.5;">${conseilDuJour}</div>
            </div>
        </div>
    </div>`;

    // üÜï Astuce nutritionnelle selon la semaine
    const astucesNutri = {
        S1: "üåü Semaine 1 : Votre corps s'adapte au d√©ficit. Restez hydrat√© et respectez les macros !",
        S2: "üìä Semaine 2 : Les premiers r√©sultats apparaissent. Prenez photos et mensurations !",
        S3: "üî• Semaine 3 : Phase intensive. Le MSM et Collag√®ne prot√®gent vos articulations.",
        S4: "üí™ Semaine 4 : Mi-parcours ! Ajustez selon vos r√©sultats visuels.",
        S5: "‚ö° Semaine 5 : Maintien de l'intensit√©. La Berb√©rine optimise votre glyc√©mie.",
        S6: "üéØ Semaine 6 : Phase critique. Ne l√¢chez rien, les Om√©ga-3 soutiennent votre m√©tabolisme.",
        S7: "üöÄ Semaine 7 : Le sprint final commence. Votre discipline paie !",
        S8: "üíé Semaine 8 : La d√©finition musculaire devient visible. Restez focus !",
        S9: "üèÜ Semaine 9 : Avant-derni√®re semaine. Poussez jusqu'au bout !",
        S10: "üëë Semaine 10 : Derni√®re ligne droite. Transformation compl√®te en vue !"
    };

    html += `<div class="alert-box alert-warning" style="background: linear-gradient(135deg, #fff9e6 0%, #ffe9a3 100%); border-left: 5px solid #ffc107; margin-bottom: 20px;">
        <div style="font-size: 13px; font-weight: bold; color: #f57c00;">${astucesNutri[semaineActuelle]}</div>
    </div>`;

    menu.repas.forEach(repas => {
        const valide = isRepasValide(repas.id);
        
        html += `<div class="nutrition-section">
            <h3>${repas.heure} - ${repas.nom}</h3>
            <div class="meal">
                <div class="meal-details">
                    <div class="detail-item"><span class="detail-label">Cal:</span> ${repas.calories}</div>
                    <div class="detail-item"><span class="detail-label">P:</span> ${repas.macros.P}g</div>
                    <div class="detail-item"><span class="detail-label">G:</span> ${repas.macros.G}g</div>
                    <div class="detail-item"><span class="detail-label">L:</span> ${repas.macros.L}g</div>
                </div>`;
        
        if (repas.note) {
            html += `<div style="background: #fff9e6; padding: 8px; border-radius: 6px; margin: 8px 0; font-size: 12px;"><strong>‚ö†Ô∏è</strong> ${repas.note}</div>`;
        }
        
        if (repas.options) {
            const today = new Date().toISOString().split('T')[0];
            const optionKey = `${today}-${repas.id}`;
            const optionSelectionnee = optionsSelectionnees[optionKey] || repas.options[0].id;
            
            html += `<div class="option-selector">
                <strong>üîÑ Choix option :</strong><br>`;
            
            repas.options.forEach(opt => {
                const isActive = opt.id === optionSelectionnee;
                html += `<button class="option-btn ${isActive ? 'active' : ''}" onclick="selectOption('${repas.id}', '${opt.id}')">${opt.nom}</button>`;
            });
            
            html += `</div>`;

            const optionChoisie = repas.options.find(o => o.id === optionSelectionnee);

            // üÜï Affichage des macros de la variante (style Foodvisor moderne)
            if (optionChoisie.macros) {
                html += `<div style="background: linear-gradient(135deg, #f0f4ff 0%, #e8f0fe 100%); padding: 12px; border-radius: 12px; margin: 12px 0; border-left: 4px solid #667eea; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; text-align: center;">
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 2px;">${optionChoisie.macros.P}g</div>
                            <div style="font-size: 9px; color: #667eea; text-transform: uppercase; font-weight: 600;">Prot√©ines</div>
                        </div>
                        <div style="background: rgba(255, 152, 0, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 18px; font-weight: bold; color: #ff9800; margin-bottom: 2px;">${optionChoisie.macros.G}g</div>
                            <div style="font-size: 9px; color: #ff9800; text-transform: uppercase; font-weight: 600;">Glucides</div>
                        </div>
                        <div style="background: rgba(81, 207, 102, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 18px; font-weight: bold; color: #51cf66; margin-bottom: 2px;">${optionChoisie.macros.L}g</div>
                            <div style="font-size: 9px; color: #51cf66; text-transform: uppercase; font-weight: 600;">Lipides</div>
                        </div>
                        <div style="background: rgba(255, 217, 61, 0.1); padding: 8px; border-radius: 8px;">
                            <div style="font-size: 18px; font-weight: bold; color: #f59f00; margin-bottom: 2px;">${optionChoisie.macros.kcal}</div>
                            <div style="font-size: 9px; color: #f59f00; text-transform: uppercase; font-weight: 600;">Calories</div>
                        </div>
                    </div>
                </div>`;
            }

            if (optionChoisie.plat) {
                html += `<div class="meal-foods">
                    <strong>üçΩÔ∏è PLAT PRINCIPAL:</strong>
                    <ul>${optionChoisie.plat.map(a => `<li>${a}</li>`).join('')}</ul>
                </div>`;

                if (optionChoisie.dessert) {
                    html += `<div class="meal-foods">
                        <strong>üç® DESSERT (30 min apr√®s):</strong>
                        <ul>${optionChoisie.dessert.map(a => `<li>${a}</li>`).join('')}</ul>
                    </div>`;
                }
            } else {
                html += `<div class="meal-foods">
                    <strong>ü•ò Composition:</strong>
                    <ul>${optionChoisie.aliments.map(a => `<li>${a}</li>`).join('')}</ul>
                </div>`;
            }
        } else if (repas.aliments) {
            html += `<div class="meal-foods">
                <strong>ü•ò Aliments:</strong>
                <ul>${repas.aliments.map(a => `<li>${a}</li>`).join('')}</ul>
            </div>`;
        }
        
        // üÜï Ajout suppl√©ments associ√©s au repas
        if (repas.supplements && repas.supplements.length > 0) {
            html += `<div class="supplements-box">
                <strong>üíä SUPPL√âMENTS √Ä PRENDRE AVEC CE REPAS :</strong>
                <ul style="margin-left: 10px; margin-top: 5px;">${repas.supplements.map(s => `<li style="margin: 3px 0;">${s}</li>`).join('')}</ul>
            </div>`;
        }
        
        // üÜï Ajout anti-inflammatoires
        if (repas.antiInflammatoires && repas.antiInflammatoires.length > 0) {
            html += `<div class="anti-inflam-box">
                <strong>üåø AJOUTS ANTI-INFLAMMATOIRES :</strong>
                <ul style="margin-left: 10px; margin-top: 5px;">${repas.antiInflammatoires.map(a => `<li style="margin: 3px 0;">${a}</li>`).join('')}</ul>
            </div>`;
        }
        
        html += `<div class="validation-checkbox ${valide ? 'validated' : ''}" onclick="toggleRepas('${repas.id}')">
            <input type="checkbox" ${valide ? 'checked' : ''} onclick="event.stopPropagation()">
            <span><strong>${valide ? '‚úÖ Valid√©' : '‚è∏Ô∏è √Ä valider'}</strong></span>
        </div>
        </div>
    </div>`;
    });
    
    // üÜï Section suppl√©ments essentiels avec cases √† cocher
    html += `<div class="nutrition-section" style="border-left-color: #51cf66;">
        <h3>üíä SUPPL√âMENTS ESSENTIELS - Checklist Journali√®re</h3>
        <div class="meal">
            <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                <strong style="color: #51cf66; font-size: 14px;">‚òÄÔ∏è MATIN (7h30, √† jeun avec caf√©)</strong>
                <div style="margin-top: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(81,207,102,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">‚òÄÔ∏è <strong>Vitamine D3</strong> : 5000 UI (1 capsule)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(81,207,102,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">üí™ <strong>Cr√©atine</strong> : 5g (dans eau/caf√©) ${jourType === 'repos' ? '‚úÖ' : '‚ö†Ô∏è ou avec repas 1'}</span>
                    </label>
                </div>
            </div>

            <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                <strong style="color: #ff9800; font-size: 14px;">üçΩÔ∏è REPAS 1 (12h00, avec repas)</strong>
                <div style="margin-top: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,152,0,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">ü¶¥ <strong>MSM</strong> : 2000mg (2 g√©lules)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,152,0,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">üí™ <strong>Cr√©atine</strong> : 5g ${jourType === 'training' ? '(si pas pris le matin)' : '(si pas pris le matin)'}</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,152,0,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">ü¶¥ <strong>Collag√®ne</strong> : 10g (dans caf√©/th√© chaud)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,152,0,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">ü©∏ <strong>Berb√©rine</strong> : 500mg (avec repas si diab√®te)</span>
                    </label>
                </div>
            </div>

            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                <strong style="color: #2196f3; font-size: 14px;">üåô SOIR (22h00, avant coucher)</strong>
                <div style="margin-top: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(33,150,243,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">üêü <strong>Om√©ga-3</strong> : 4g (2g si saumon au d√Æner)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(33,150,243,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">üò¥ <strong>Magn√©sium</strong> : 400mg (sommeil + insuline)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(33,150,243,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">ü¶¥ <strong>Collag√®ne</strong> : 5g (dans eau chaude)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 8px; cursor: pointer; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(33,150,243,0.1)'" onmouseout="this.style.background='transparent'">
                        <input type="checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 13px;">ü©∏ <strong>Berb√©rine</strong> : 500mg (avec repas 3 si diab√®te)</span>
                    </label>
                </div>
            </div>
        </div>
    </div>`;

    document.getElementById('menu-container').innerHTML = html;
}

// üÜï Fonction s√©lection option
function selectOption(repasId, optionId) {
    const today = new Date().toISOString().split('T')[0];
    const optionKey = `${today}-${repasId}`;
    optionsSelectionnees[optionKey] = optionId;
    localStorage.setItem('options-repas', JSON.stringify(optionsSelectionnees));
    afficherMenu();
    showAutoSave();
}

function toggleRepas(repasId) {
    const today = new Date().toISOString().split('T')[0];
    const key = `repas-${today}`;
    let validations = JSON.parse(localStorage.getItem(key) || '[]');
    const index = validations.indexOf(repasId);
    
    if (index > -1) {
        validations.splice(index, 1);
    } else {
        validations.push(repasId);
    }
    
    localStorage.setItem(key, JSON.stringify(validations));
    
    afficherMenu();
    calculerProgression();
    showAutoSave();
}

function isRepasValide(repasId) {
    const today = new Date().toISOString().split('T')[0];
    const key = `repas-${today}`;
    const validations = JSON.parse(localStorage.getItem(key) || '[]');
    return validations.includes(repasId);
}

function calculerProgression() {
    const menu = MENUS_BASE[jourType];
    const config = PLAN_HYBRIDE.semaines[semaineActuelle];
    const today = new Date().toISOString().split('T')[0];
    const key = `repas-${today}`;
    const validations = JSON.parse(localStorage.getItem(key) || '[]');
    
    let totalCal = 0, totalP = 0, totalG = 0, totalL = 0;
    validations.forEach(id => {
        const repas = menu.repas.find(r => r.id === id);
        if (repas && repas.calories) {
            totalCal += repas.calories;
            totalP += repas.macros.P;
            totalG += repas.macros.G;
            totalL += repas.macros.L;
        }
    });

    const grigJour = grignotages.filter(g => g.date === today);
    const totalGrig = grigJour.reduce((sum, g) => sum + g.calories, 0);
    totalCal += totalGrig;

    document.getElementById('cal-actuel').textContent = totalCal;
    document.getElementById('prot-actuel').textContent = totalP;
    document.getElementById('gluc-actuel').textContent = totalG;
    document.getElementById('lip-actuel').textContent = totalL;

    const pct = Math.min(100, Math.round((totalCal / config.calories[jourType]) * 100));
    document.getElementById('progress-bar').style.width = pct + '%';
    document.getElementById('progress-bar').textContent = pct + '%';
}

function afficherSemaine(num) {
    semaineActuelle = 'S' + num;
    localStorage.setItem('semaineActuelle', semaineActuelle);  // üÜï Sauvegarde de la semaine
    afficherMenu();
    calculerProgression();
    afficherCarteSemaine();
    updateTimelineVisuel();
    showAutoSave();
}

// üÜï Fonction pour charger la semaine sauvegard√©e
function loadSemaineActuelle() {
    const saved = localStorage.getItem('semaineActuelle');
    if (saved && saved.match(/^S([1-9]|10)$/)) {
        semaineActuelle = saved;
        const num = parseInt(saved.substring(1));
        updateTimelineVisuel();
    }
}

// üÜï Timeline √©tendue √† 10 semaines
function updateTimelineVisuel() {
    const items = document.querySelectorAll('.timeline-item');
    const numActuel = parseInt(semaineActuelle.substring(1));
    
    items.forEach((item, i) => {
        const num = i + 1;
        item.classList.remove('active', 'completed', 'future');
        const pesee = pesees.find(p => p.semaine === 'S' + num);
        
        if (num < numActuel || pesee) {
            item.classList.add('completed');
        } else if (num === numActuel) {
            item.classList.add('active');
        } else {
            item.classList.add('future');
        }
    });

    const progress = ((numActuel - 1) / 9) * 90;
    document.getElementById('timeline-progress').style.width = progress + '%';
}

function afficherCarteSemaine() {
    const config = PLAN_HYBRIDE.semaines[semaineActuelle];
    const pesee = pesees.find(p => p.semaine === semaineActuelle);
    
    let html = `<div class="week-card ${config.phase}">
        <div class="week-header">
            <div class="week-title">${semaineActuelle} - ${config.nom}</div>
            <div class="phase-badge ${config.phase}">${config.phase.toUpperCase()}</div>
        </div>
        <div style="margin: 15px 0; color: #666; font-size: 14px;">
            <strong>üéØ Objectif :</strong> ${config.objectif}
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">Calories Training</div>
                <div class="stat-value">${config.calories.training}</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Calories Repos</div>
                <div class="stat-value">${config.calories.repos}</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">D√©ficit cible</div>
                <div class="stat-value">${config.deficitCible}</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Perte vis√©e</div>
                <div class="stat-value">${config.perteVisee}kg</div>
            </div>
        </div>
        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-top: 15px;">
            <strong>üìä Macros Training :</strong> P${config.macros.training.P}g / G${config.macros.training.G}g / L${config.macros.training.L}g<br>
            <strong>üìä Macros Repos :</strong> P${config.macros.repos.P}g / G${config.macros.repos.G}g / L${config.macros.repos.L}g
        </div>`;
    
    if (pesee) {
        const deltaKg = pesee.deltaKg || 0;
        const deltaColor = deltaKg < 0 ? '#51cf66' : '#ff6b6b';
        html += `<div class="alert-box alert-success" style="margin-top: 15px;">
            <strong>‚úÖ Pes√©e enregistr√©e</strong><br>
            Poids: ${pesee.poids}kg (<span style="color: ${deltaColor}">${deltaKg > 0 ? '+' : ''}${deltaKg.toFixed(1)}kg</span>)<br>
            % Graisse: ${pesee.bf}% | Tour taille: ${pesee.taille}cm<br>
            √ânergie: ${pesee.energie}/10 | Digestion: ${pesee.digestion}/10
        </div>`;
    } else {
        html += `<div class="alert-box alert-warning" style="margin-top: 15px;">
            <strong>‚ö†Ô∏è Pes√©e manquante</strong><br>
            Pense √† te peser ce vendredi ou samedi matin !
        </div>`;
    }
    
    html += `</div>`;
    document.getElementById('carte-semaine-actuelle').innerHTML = html;
}

function ouvrirFormulairePesee() {
    document.getElementById('input-semaine').value = semaineActuelle;
    document.getElementById('modal-pesee').classList.add('show');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('show');
}

function enregistrerPesee() {
    const semaine = document.getElementById('input-semaine').value;
    const poids = parseFloat(document.getElementById('input-poids').value);
    const bf = parseFloat(document.getElementById('input-bf').value);
    const taille = parseFloat(document.getElementById('input-taille').value) || null;
    const bras = parseFloat(document.getElementById('input-bras').value) || null;
    const energie = parseInt(document.getElementById('input-energie').value) || null;
    const digestion = parseInt(document.getElementById('input-digestion').value) || null;
    const notes = document.getElementById('input-notes-pesee').value;

    if (!poids || !bf) {
        showNotification('‚ö†Ô∏è Poids et % graisse obligatoires !', 'warning');
        return;
    }

    const existingIndex = pesees.findIndex(p => p.semaine === semaine);
    const peseePrecedente = pesees.find(p => {
        const numSem = parseInt(semaine.substring(1));
        return p.semaine === 'S' + (numSem - 1);
    });

    const masseMaigre = poids * (1 - bf / 100);
    const masseGrasse = poids * (bf / 100);
    
    const pesee = {
        semaine,
        date: new Date().toISOString().split('T')[0],
        poids,
        bf,
        masseMaigre: parseFloat(masseMaigre.toFixed(1)),
        masseGrasse: parseFloat(masseGrasse.toFixed(1)),
        taille,
        bras,
        energie,
        digestion,
        notes,
        deltaKg: peseePrecedente ? parseFloat((poids - peseePrecedente.poids).toFixed(1)) : 0,
        deltaBF: peseePrecedente ? parseFloat((bf - peseePrecedente.bf).toFixed(1)) : 0,
        deltaTaille: peseePrecedente && taille && peseePrecedente.taille ? parseFloat((taille - peseePrecedente.taille).toFixed(1)) : null
    };

    if (existingIndex > -1) {
        pesees[existingIndex] = pesee;
    } else {
        pesees.push(pesee);
    }

    pesees.sort((a, b) => {
        const numA = parseInt(a.semaine.substring(1));
        const numB = parseInt(b.semaine.substring(1));
        return numA - numB;
    });

    localStorage.setItem('pesees-hebdo', JSON.stringify(pesees));

    document.getElementById('input-poids').value = '';
    document.getElementById('input-bf').value = '';
    document.getElementById('input-taille').value = '';
    document.getElementById('input-bras').value = '';
    document.getElementById('input-energie').value = '';
    document.getElementById('input-digestion').value = '';
    document.getElementById('input-notes-pesee').value = '';

    closeModal('modal-pesee');
    afficherCarteSemaine();
    afficherGraphiquePoids();
    afficherHistoriquePesees();
    afficherAlertes();
    updateTimelineVisuel();
    showAutoSave();
}

function afficherGraphiquePoids() {
    if (pesees.length === 0) {
        document.getElementById('svg-poids').innerHTML = '<text x="50%" y="50%" text-anchor="middle" fill="#999" font-size="14">Aucune donn√©e - Ajoute ta premi√®re pes√©e !</text>';
        return;
    }

    const svg = document.getElementById('svg-poids');
    const width = svg.clientWidth || 800;
    const height = 250;
    const padding = {top: 20, right: 50, bottom: 40, left: 50};
    
    const poidsData = [{semaine: 'S0', poids: PLAN_HYBRIDE.poidsInitial}, ...pesees];
    const minPoids = Math.min(...poidsData.map(p => p.poids)) - 1;
    const maxPoids = Math.max(...poidsData.map(p => p.poids)) + 1;
    
    const xScale = (width - padding.left - padding.right) / (poidsData.length - 1);
    const yScale = (height - padding.top - padding.bottom) / (maxPoids - minPoids);
    
    let pathD = '';
    let points = '';
    
    poidsData.forEach((p, i) => {
        const x = padding.left + i * xScale;
        const y = height - padding.bottom - ((p.poids - minPoids) * yScale);
        
        if (i === 0) pathD += `M ${x} ${y}`;
        else pathD += ` L ${x} ${y}`;
        
        const color = p.semaine === semaineActuelle ? '#667eea' : '#51cf66';
        points += `<circle cx="${x}" cy="${y}" r="5" fill="${color}" stroke="white" stroke-width="2"/>`;
        points += `<text x="${x}" y="${y - 10}" text-anchor="middle" font-size="11" font-weight="bold" fill="${color}">${p.poids}kg</text>`;
    });
    
    let gridLines = '';
    for (let i = 0; i <= 4; i++) {
        const y = padding.top + (height - padding.top - padding.bottom) * i / 4;
        const valeur = (maxPoids - (maxPoids - minPoids) * i / 4).toFixed(1);
        gridLines += `<line x1="${padding.left}" y1="${y}" x2="${width - padding.right}" y2="${y}" stroke="#e0e0e0" stroke-width="1"/>`;
        gridLines += `<text x="${padding.left - 10}" y="${y + 4}" text-anchor="end" font-size="10" fill="#999">${valeur}kg</text>`;
    }
    
    let xLabels = '';
    poidsData.forEach((p, i) => {
        const x = padding.left + i * xScale;
        xLabels += `<text x="${x}" y="${height - 10}" text-anchor="middle" font-size="11" fill="#666">${p.semaine}</text>`;
    });
    
    svg.innerHTML = `
        ${gridLines}
        <path d="${pathD}" fill="none" stroke="#667eea" stroke-width="3"/>
        ${points}
        ${xLabels}
        <text x="${width / 2}" y="15" text-anchor="middle" font-size="12" font-weight="bold" fill="#667eea">√âvolution du poids</text>
    `;
}

function afficherHistoriquePesees() {
    if (pesees.length === 0) {
        document.getElementById('historique-pesees').innerHTML = '<p style="color: #999; text-align: center;">Aucune pes√©e enregistr√©e</p>';
        return;
    }

    let html = '';
    pesees.slice().reverse().forEach(p => {
        const deltaColor = p.deltaKg < 0 ? '#51cf66' : p.deltaKg > 0 ? '#ff6b6b' : '#999';
        html += `<div class="progress-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div>
                    <strong style="font-size: 18px; color: #667eea;">${p.semaine}</strong>
                    <span style="color: #999; margin-left: 10px; font-size: 12px;">${new Date(p.date).toLocaleDateString('fr-FR')}</span>
                </div>
                <button class="btn btn-danger" onclick="supprimerPesee('${p.semaine}')" style="padding: 6px 12px; font-size: 11px;">Supprimer</button>
            </div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Poids</div>
                    <div class="stat-value">${p.poids}kg</div>
                    ${p.deltaKg !== 0 ? `<div style="font-size: 11px; color: ${deltaColor}; font-weight: bold;">${p.deltaKg > 0 ? '+' : ''}${p.deltaKg}kg</div>` : ''}
                </div>
                <div class="stat-item">
                    <div class="stat-label">% Graisse</div>
                    <div class="stat-value">${p.bf}%</div>
                    ${p.deltaBF !== 0 ? `<div style="font-size: 11px; color: ${p.deltaBF < 0 ? '#51cf66' : '#ff6b6b'}; font-weight: bold;">${p.deltaBF > 0 ? '+' : ''}${p.deltaBF}%</div>` : ''}
                </div>
                ${p.taille ? `<div class="stat-item">
                    <div class="stat-label">Tour taille</div>
                    <div class="stat-value">${p.taille}cm</div>
                    ${p.deltaTaille ? `<div style="font-size: 11px; color: ${p.deltaTaille < 0 ? '#51cf66' : '#ff6b6b'}; font-weight: bold;">${p.deltaTaille > 0 ? '+' : ''}${p.deltaTaille}cm</div>` : ''}
                </div>` : ''}
                <div class="stat-item">
                    <div class="stat-label">Masse maigre</div>
                    <div class="stat-value">${p.masseMaigre}kg</div>
                </div>
            </div>
            ${p.energie || p.digestion ? `<div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 12px;">
                ${p.energie ? `‚ö° √ânergie: ${p.energie}/10 | ` : ''}
                ${p.digestion ? `üåø Digestion: ${p.digestion}/10` : ''}
            </div>` : ''}
            ${p.notes ? `<div style="background: #fff9e6; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 12px;">
                <strong>üìù Notes :</strong> ${p.notes}
            </div>` : ''}
        </div>`;
    });
    document.getElementById('historique-pesees').innerHTML = html;
}

function supprimerPesee(semaine) {
    if (!confirm(`Supprimer la pes√©e ${semaine} ?`)) return;
    pesees = pesees.filter(p => p.semaine !== semaine);
    localStorage.setItem('pesees-hebdo', JSON.stringify(pesees));
    afficherCarteSemaine();
    afficherGraphiquePoids();
    afficherHistoriquePesees();
    afficherAlertes();
    updateTimelineVisuel();
    showAutoSave();
}

function afficherAlertes() {
    if (pesees.length < 2) {
        document.getElementById('alertes-container').innerHTML = '';
        return;
    }

    const dernierePesee = pesees[pesees.length - 1];
    const config = PLAN_HYBRIDE.semaines[dernierePesee.semaine];
    const deltaKg = dernierePesee.deltaKg;
    const perteVisee = config.perteVisee;
    
    let html = '<div class="progress-card"><h3 style="color: #667eea; margin-bottom: 15px;">üö® Alertes & Recommandations</h3>';

    if (Math.abs(deltaKg - (-perteVisee)) > 0.5) {
        if (deltaKg > -0.3) {
            html += `<div class="alert-box alert-danger">
                <strong>üî¥ ALERTE : Perte trop lente</strong><br>
                Perte r√©elle: ${deltaKg.toFixed(1)}kg | Objectif: -${perteVisee}kg<br>
                <strong>Actions :</strong><br>
                ‚Ä¢ R√©duire calories de 100-150 kcal/jour<br>
                ‚Ä¢ V√©rifier adh√©rence (repas valid√©s)<br>
                ‚Ä¢ Augmenter NEAT (marche 30 min/jour)
            </div>`;
        } else if (deltaKg < -1.5) {
            html += `<div class="alert-box alert-warning">
                <strong>üü† ATTENTION : Perte trop rapide</strong><br>
                Perte r√©elle: ${deltaKg.toFixed(1)}kg | Objectif: -${perteVisee}kg<br>
                <strong>Actions :</strong><br>
                ‚Ä¢ Augmenter calories de 100-150 kcal/jour<br>
                ‚Ä¢ Ajouter glucides autour training<br>
                ‚Ä¢ Surveiller masse maigre (prot√©ines 2g/kg)
            </div>`;
        }
    } else {
        html += `<div class="alert-box alert-success">
            <strong>‚úÖ PROGRESSION OPTIMALE</strong><br>
            Perte r√©elle: ${deltaKg.toFixed(1)}kg | Objectif: -${perteVisee}kg<br>
            Continue exactement comme √ßa ! üí™
        </div>`;
    }

    if (dernierePesee.energie && dernierePesee.energie < 6) {
        html += `<div class="alert-box alert-warning">
            <strong>‚ö° √ânergie basse (${dernierePesee.energie}/10)</strong><br>
            ‚Ä¢ Augmenter glucides pr√©-training (+20g)<br>
            ‚Ä¢ Sommeil 8h minimum<br>
            ‚Ä¢ Envisager refeed si phase s√®che
        </div>`;
    }

    const numSemaine = parseInt(dernierePesee.semaine.substring(1));
    if (numSemaine === 10) {
        html += `<div class="alert-box alert-success">
            <strong>üéâ SEMAINE 10 : BILAN FINAL</strong><br>
            F√©licitations pour avoir termin√© le programme !<br>
            Pense √† faire le bilan complet :<br>
            ‚Ä¢ Photos avant/apr√®s<br>
            ‚Ä¢ Mensurations compl√®tes<br>
            ‚Ä¢ Analyses sanguines si n√©cessaire
        </div>`;
    }

    html += '</div>';
    document.getElementById('alertes-container').innerHTML = html;
}

function openGrignotageModal() {
    document.getElementById('modal-grignotage').classList.add('show');
}

function ajouterGrignotage() {
    const aliment = document.getElementById('input-aliment').value.trim();
    const quantite = document.getElementById('input-quantite').value;
    const calories = document.getElementById('input-calories').value;
    
    if (!aliment || !quantite || !calories) {
        showNotification('‚ö†Ô∏è Remplis tous les champs', 'warning');
        return;
    }

    const grig = {
        id: Date.now(),
        date: new Date().toISOString().split('T')[0],
        heure: new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}),
        aliment,
        quantite: parseInt(quantite),
        calories: parseInt(calories)
    };

    grignotages.push(grig);
    localStorage.setItem('grignotages', JSON.stringify(grignotages));

    document.getElementById('input-aliment').value = '';
    document.getElementById('input-quantite').value = '';
    document.getElementById('input-calories').value = '';

    closeModal('modal-grignotage');
    loadGrignotages();
    calculerProgression();
    showAutoSave();
}

function loadGrignotages() {
    grignotages = JSON.parse(localStorage.getItem('grignotages') || '[]');
    const today = new Date().toISOString().split('T')[0];
    const grigJour = grignotages.filter(g => g.date === today);
    
    if (grigJour.length === 0) {
        document.getElementById('liste-grignotages').innerHTML = '<p style="color: #999; text-align: center;">Aucun grignotage aujourd\'hui üëç</p>';
        document.getElementById('total-grignotages').textContent = '+0 kcal';
        return;
    }

    let html = '';
    grigJour.forEach(g => {
        html += `<div class="grignotage-item"><div><strong>${g.heure} - ${g.aliment}</strong><br><small>${g.quantite}g ‚Ä¢ ${g.calories} kcal</small></div><button class="btn btn-danger" onclick="supprimerGrignotage(${g.id})">√ó</button></div>`;
    });
    document.getElementById('liste-grignotages').innerHTML = html;

    const total = grigJour.reduce((sum, g) => sum + g.calories, 0);
    const color = total > 500 ? '#ff6b6b' : total > 300 ? '#ffc107' : '#51cf66';
    document.getElementById('total-grignotages').innerHTML = `<span style="color: ${color}">+${total} kcal</span>`;
}

function supprimerGrignotage(id) {
    if (!confirm('Supprimer ce grignotage ?')) return;
    grignotages = grignotages.filter(g => g.id !== id);
    localStorage.setItem('grignotages', JSON.stringify(grignotages));
    loadGrignotages();
    calculerProgression();
    showAutoSave();
}

function exportRapport() {
    const config = PLAN_HYBRIDE.semaines[semaineActuelle];
    const menu = MENUS_BASE[jourType];
    const today = new Date().toISOString().split('T')[0];
    const key = `repas-${today}`;
    const validations = JSON.parse(localStorage.getItem(key) || '[]');
    const grigJour = grignotages.filter(g => g.date === today);
    
    let totalCal = 0, totalP = 0, totalG = 0, totalL = 0;
    validations.forEach(id => {
        const repas = menu.repas.find(r => r.id === id);
        if (repas && repas.calories) {
            totalCal += repas.calories;
            totalP += repas.macros.P;
            totalG += repas.macros.G;
            totalL += repas.macros.L;
        }
    });

    const totalGrig = grigJour.reduce((sum, g) => sum + g.calories, 0);
    totalCal += totalGrig;

    let rapport = `üî• RAPPORT PLAN S√àCHE - ${today}\n`;
    rapport += `${semaineActuelle} - ${config.nom} (${config.phase.toUpperCase()})\n`;
    rapport += `${jourType === 'training' ? 'üèãÔ∏è JOUR TRAINING' : 'üí§ JOUR REPOS'}\n`;
    rapport += `${SAISON_ACTUELLE.emoji} Saison: ${SAISON_ACTUELLE.nom}\n\n`;
    
    rapport += `üéØ OBJECTIFS SEMAINE\n`;
    rapport += `Calories: ${config.calories[jourType]} kcal | D√©ficit: ${config.deficitCible} kcal\n`;
    rapport += `Perte vis√©e: -${config.perteVisee}kg\n`;
    rapport += `Macros: P${config.macros[jourType].P}g / G${config.macros[jourType].G}g / L${config.macros[jourType].L}g\n\n`;
    
    rapport += `‚úÖ R√âALISATIONS JOUR\n`;
    rapport += `Calories: ${totalCal} kcal (${Math.round((totalCal / config.calories[jourType]) * 100)}%)\n`;
    rapport += `Prot√©ines: ${totalP}g | Glucides: ${totalG}g | Lipides: ${totalL}g\n`;
    rapport += `Repas valid√©s: ${validations.length}/${menu.repas.length}\n\n`;
    
    if (grigJour.length > 0) {
        rapport += `üç™ GRIGNOTAGES (+${totalGrig} kcal)\n`;
        grigJour.forEach(g => rapport += `${g.heure} - ${g.aliment} ${g.quantite}g (+${g.calories} kcal)\n`);
        rapport += `\n`;
    }

    rapport += `üìù NOTES\n${document.getElementById('notes-jour')?.value || '(Aucune note)'}\n\n`;
    
    rapport += `üìä PROGRESSION PROGRAMME\n`;
    rapport += `Semaine actuelle: ${semaineActuelle}/S10\n`;
    rapport += `Pes√©es enregistr√©es: ${pesees.length}/10\n`;
    if (pesees.length > 0) {
        const dernierePesee = pesees[pesees.length - 1];
        rapport += `Dernier poids: ${dernierePesee.poids}kg (${dernierePesee.bf}%)\n`;
        rapport += `√âvolution: ${dernierePesee.deltaKg > 0 ? '+' : ''}${dernierePesee.deltaKg}kg\n`;
    }

    navigator.clipboard.writeText(rapport).then(() => showNotification('‚úÖ Rapport copi√© !', 'success')).catch(() => showNotification('‚ùå Erreur copie', 'error'));
}

function exportRapportSemaine() {
    const config = PLAN_HYBRIDE.semaines[semaineActuelle];
    const pesee = pesees.find(p => p.semaine === semaineActuelle);
    
    let rapport = `üìä RAPPORT ${semaineActuelle} - ${config.nom}\n`;
    rapport += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
    rapport += `üéØ OBJECTIFS\n`;
    rapport += `Phase: ${config.phase.toUpperCase()}\n`;
    rapport += `Objectif: ${config.objectif}\n`;
    rapport += `Calories Training: ${config.calories.training} kcal\n`;
    rapport += `Calories Repos: ${config.calories.repos} kcal\n`;
    rapport += `D√©ficit cible: ${config.deficitCible} kcal/jour\n`;
    rapport += `Perte vis√©e: -${config.perteVisee}kg\n\n`;
    
    if (pesee) {
        rapport += `‚öñÔ∏è R√âSULTATS\n`;
        rapport += `Poids: ${pesee.poids}kg (${pesee.deltaKg > 0 ? '+' : ''}${pesee.deltaKg}kg)\n`;
        rapport += `% Graisse: ${pesee.bf}% (${pesee.deltaBF > 0 ? '+' : ''}${pesee.deltaBF}%)\n`;
        rapport += `Masse maigre: ${pesee.masseMaigre}kg\n`;
        rapport += `Masse grasse: ${pesee.masseGrasse}kg\n`;
        if (pesee.taille) rapport += `Tour taille: ${pesee.taille}cm${pesee.deltaTaille ? ` (${pesee.deltaTaille > 0 ? '+' : ''}${pesee.deltaTaille}cm)` : ''}\n`;
        rapport += `\n`;
        
        const ecart = pesee.deltaKg - (-config.perteVisee);
        if (Math.abs(ecart) > 0.5) {
            rapport += `‚ö†Ô∏è ANALYSE\n`;
            if (ecart > 0.5) {
                rapport += `Perte insuffisante (${Math.abs(ecart).toFixed(1)}kg de moins que pr√©vu)\n`;
                rapport += `‚Üí R√©duire calories 100-150 kcal\n`;
                rapport += `‚Üí V√©rifier adh√©rence nutrition\n`;
            } else {
                rapport += `Perte excessive (${Math.abs(ecart).toFixed(1)}kg de plus que pr√©vu)\n`;
                rapport += `‚Üí Augmenter calories 100-150 kcal\n`;
                rapport += `‚Üí Surveiller masse maigre\n`;
            }
            rapport += `\n`;
        }
        
        if (pesee.notes) {
            rapport += `üìù NOTES\n${pesee.notes}\n\n`;
        }
    } else {
        rapport += `‚ö†Ô∏è PES√âE NON EFFECTU√âE\n`;
        rapport += `Penser √† se peser ce vendredi/samedi !\n\n`;
    }

    navigator.clipboard.writeText(rapport).then(() => showNotification('‚úÖ Rapport semaine copi√© !', 'success')).catch(() => showNotification('‚ùå Erreur copie', 'error'));
}

function resetJour() {
    if (!confirm('‚ö†Ô∏è R√©initialiser toutes les donn√©es d\'aujourd\'hui ?')) return;
    const today = new Date().toISOString().split('T')[0];
    localStorage.removeItem(`repas-${today}`);
    grignotages = grignotages.filter(g => g.date !== today);
    localStorage.setItem('grignotages', JSON.stringify(grignotages));
    afficherMenu();
    loadGrignotages();
    calculerProgression();
    showNotification('‚úÖ Journ√©e r√©initialis√©e', 'success');
}

function resetSemaine() {
    if (!confirm(`‚ö†Ô∏è Effacer TOUTES les donn√©es de ${semaineActuelle} ?`)) return;
    
    const dateDebut = new Date(PLAN_HYBRIDE.dateDebut);
    const numSemaine = parseInt(semaineActuelle.substring(1));
    const debutSemaine = new Date(dateDebut);
    debutSemaine.setDate(dateDebut.getDate() + ((numSemaine - 1) * 7));
    
    for (let i = 0; i < 7; i++) {
        const date = new Date(debutSemaine);
        date.setDate(debutSemaine.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        localStorage.removeItem(`repas-${dateStr}`);
    }
    
    grignotages = grignotages.filter(g => {
        const gDate = new Date(g.date);
        return gDate < debutSemaine || gDate >= new Date(debutSemaine.getTime() + 7 * 24 * 60 * 60 * 1000);
    });
    localStorage.setItem('grignotages', JSON.stringify(grignotages));
    
    pesees = pesees.filter(p => p.semaine !== semaineActuelle);
    localStorage.setItem('pesees-hebdo', JSON.stringify(pesees));
    
    afficherMenu();
    loadGrignotages();
    calculerProgression();
    afficherCarteSemaine();
    afficherGraphiquePoids();
    afficherHistoriquePesees();
    updateTimelineVisuel();
    
    showNotification('‚úÖ Semaine r√©initialis√©e', 'success');
}

function resetTout() {
    if (!confirm('üóëÔ∏è ATTENTION : Effacer TOUTES les donn√©es ?')) return;
    if (!confirm('‚ö†Ô∏è DERNI√àRE CONFIRMATION\n\nVous allez perdre 100% de vos donn√©es.\n\nContinuer ?')) return;
    
    const keysToRemove = [];
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('repas-') || key === 'grignotages' || key === 'pesees-hebdo' || key === 'jourType' || key === 'options-repas') {
            keysToRemove.push(key);
        }
    }
    
    keysToRemove.forEach(key => localStorage.removeItem(key));
    
    location.reload();
}

function telechargerBackup() {
    const backup = {
        version: '5.0-seche-10sem',
        dateExport: new Date().toISOString(),
        dateDebut: PLAN_HYBRIDE.dateDebut,
        poidsInitial: PLAN_HYBRIDE.poidsInitial,
        tailleInitiale: PLAN_HYBRIDE.tailleInitiale,
        semaineActuelle: semaineActuelle,
        jourType: jourType,
        repasValidations: {},
        grignotages: grignotages,
        pesees: pesees,
        optionsSelectionnees: optionsSelectionnees
    };
    
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('repas-')) {
            const date = key.replace('repas-', '');
            backup.repasValidations[date] = JSON.parse(localStorage.getItem(key));
        }
    }
    
    const nbJours = Object.keys(backup.repasValidations).length;
    const nbPesees = backup.pesees.length;
    const nbGrignotages = backup.grignotages.length;
    
    backup.stats = {nbJours, nbPesees, nbGrignotages};
    
    const jsonString = JSON.stringify(backup, null, 2);
    const blob = new Blob([jsonString], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `backup-seche-10sem-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    localStorage.setItem('last-backup', new Date().toISOString());
    updateLastBackupDate();
    
    showNotification(`‚úÖ Backup t√©l√©charg√© !<br><br>üìä Contenu :<br>- ${nbJours} jours de donn√©es<br>- ${nbPesees} pes√©es<br>- ${nbGrignotages} grignotages`, 'success');
}

function restaurerBackup(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!confirm('üì• Restaurer ce backup ?\n\n‚ö†Ô∏è Cela va REMPLACER toutes tes donn√©es actuelles !')) {
        event.target.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const backup = JSON.parse(e.target.result);
            
            PLAN_HYBRIDE.dateDebut = backup.dateDebut;
            PLAN_HYBRIDE.poidsInitial = backup.poidsInitial;
            PLAN_HYBRIDE.tailleInitiale = backup.tailleInitiale;
            
            Object.entries(backup.repasValidations).forEach(([date, validations]) => {
                localStorage.setItem(`repas-${date}`, JSON.stringify(validations));
            });
            
            grignotages = backup.grignotages || [];
            localStorage.setItem('grignotages', JSON.stringify(grignotages));
            
            pesees = backup.pesees || [];
            localStorage.setItem('pesees-hebdo', JSON.stringify(pesees));
            
            if (backup.optionsSelectionnees) {
                optionsSelectionnees = backup.optionsSelectionnees;
                localStorage.setItem('options-repas', JSON.stringify(optionsSelectionnees));
            }
            
            if (backup.jourType) {
                jourType = backup.jourType;
                localStorage.setItem('jourType', jourType);
            }
            
            showNotification(`‚úÖ Backup restaur√© !<br><br>üìä Donn√©es import√©es :<br>- ${backup.stats?.nbJours || 0} jours<br>- ${backup.stats?.nbPesees || 0} pes√©es<br>- ${backup.stats?.nbGrignotages || 0} grignotages`, 'success');

            setTimeout(() => location.reload(), 2000);

        } catch (error) {
            showNotification('‚ùå Erreur lors de la restauration !', 'error');
        }
    };
    
    reader.readAsText(file);
    event.target.value = '';
}

function updateLastBackupDate() {
    const lastBackup = localStorage.getItem('last-backup');
    if (lastBackup) {
        const date = new Date(lastBackup);
        const formatted = date.toLocaleDateString('fr-FR') + ' √† ' + date.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'});
        document.getElementById('last-backup-date').textContent = formatted;
    }
}

window.addEventListener('load', updateLastBackupDate);

function showAutoSave() {
    const indicator = document.getElementById('auto-save-indicator');
    indicator.classList.add('show');
    setTimeout(() => indicator.classList.remove('show'), 2000);
}

// üÜï Fonction notification personnalis√©e qui se ferme au clic
function showNotification(message, type = 'success') {
    // Supprimer notifications existantes
    document.querySelectorAll('.notification-overlay, .custom-notification').forEach(el => el.remove());

    // Cr√©er overlay
    const overlay = document.createElement('div');
    overlay.className = 'notification-overlay';

    // Cr√©er notification
    const notification = document.createElement('div');
    notification.className = `custom-notification ${type}`;
    notification.innerHTML = `
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">${message}</div>
        <div style="font-size: 12px; color: #999; margin-top: 10px;">üëÜ Cliquez n'importe o√π pour fermer</div>
    `;

    // Fonction pour fermer
    const fermer = () => {
        notification.remove();
        overlay.remove();
    };

    notification.onclick = fermer;
    overlay.onclick = fermer;

    // Auto-fermeture apr√®s 5 secondes
    setTimeout(fermer, 5000);

    document.body.appendChild(overlay);
    document.body.appendChild(notification);
}

// üÜï FONCTION AFFICHAGE ONGLETS MODIFI√âE
function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById('tab-' + tabName).classList.add('active');
    event.target.classList.add('active');

    if (tabName === 'suivi10sem') {
        afficherCarteSemaine();
        afficherGraphiquePoids();
        afficherHistoriquePesees();
        afficherAlertes();
    }
    if (tabName === 'saison') afficherSaison();

    // üÜï Nouveaux onglets
    if (tabName === 'supplements') afficherStackSupplements();
    if (tabName === 'ajustements') afficherAjustementsMacros();
}

// üÜï FONCTION AFFICHAGE STACK SUPPL√âMENTS SIMPLIFI√â
function afficherStackSupplements() {
    const stack = STACK_SUPPLEMENTS_COMPLET;

    // üÜï Version simplifi√©e avec checklists modernes
    let html = `
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
        <h2 style="margin: 0 0 10px 0; font-size: 20px;">üíä STACK SUPPL√âMENTS ESSENTIELS</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
            <div>
                <div style="font-size: 28px; font-weight: bold;">8</div>
                <div style="font-size: 12px; opacity: 0.9;">suppl√©ments</div>
            </div>
            <div>
                <div style="font-size: 28px; font-weight: bold;">136‚Ç¨</div>
                <div style="font-size: 12px; opacity: 0.9;">/mois (~4.50‚Ç¨/jour)</div>
            </div>
        </div>
    </div>

    <!-- CHECKLIST TRAINING -->
    <div class="week-card" style="border-left-color: #667eea;">
        <h3 style="color: #667eea; margin-bottom: 20px;">üèãÔ∏è JOURS TRAINING (Lun/Mer/Ven)</h3>

        <!-- MATIN -->
        <div style="background: #fff9e6; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #ffd93d;">
            <strong style="color: #f59f00; font-size: 15px; display: block; margin-bottom: 12px;">‚òÄÔ∏è MATIN (7h30, √† jeun avec caf√©)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(255,217,61,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #ffd93d;">
                    <span style="font-size: 14px; flex: 1;">‚òÄÔ∏è <strong>Vitamine D3</strong> - 5000 UI <small style="color: #999;">(immunit√©)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(255,217,61,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #ffd93d;">
                    <span style="font-size: 14px; flex: 1;">üí™ <strong>Cr√©atine</strong> - 5g <small style="color: #999;">(force + volume)</small></span>
                </label>
            </div>
        </div>

        <!-- REPAS 1 -->
        <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #51cf66;">
            <strong style="color: #51cf66; font-size: 15px; display: block; margin-bottom: 12px;">üçΩÔ∏è REPAS 1 (12h00, avec repas)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(81,207,102,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #51cf66;">
                    <span style="font-size: 14px; flex: 1;">ü¶¥ <strong>MSM</strong> - 2000mg <small style="color: #999;">(articulations)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(81,207,102,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #51cf66;">
                    <span style="font-size: 14px; flex: 1;">ü¶¥ <strong>Collag√®ne</strong> - 10g <small style="color: #999;">(peau + articulations)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(81,207,102,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #51cf66;">
                    <span style="font-size: 14px; flex: 1;">ü©∏ <strong>Berb√©rine</strong> - 500mg <small style="color: #999;">(glyc√©mie)</small></span>
                </label>
            </div>
        </div>

        <!-- POST-TRAINING -->
        <div style="background: #f0f4ff; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #667eea;">
            <strong style="color: #667eea; font-size: 15px; display: block; margin-bottom: 12px;">üí™ POST-TRAINING (15h45, juste apr√®s)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(102,126,234,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #667eea;">
                    <span style="font-size: 14px; flex: 1;">üí™ <strong>Whey</strong> - 30g <small style="color: #999;">(r√©cup√©ration)</small></span>
                </label>
            </div>
        </div>

        <!-- REPAS 3 -->
        <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #ff9800;">
            <strong style="color: #ff9800; font-size: 15px; display: block; margin-bottom: 12px;">üçΩÔ∏è REPAS 3 (19h30, avec repas)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(255,152,0,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #ff9800;">
                    <span style="font-size: 14px; flex: 1;">ü©∏ <strong>Berb√©rine</strong> - 500mg <small style="color: #999;">(glyc√©mie)</small></span>
                </label>
            </div>
        </div>

        <!-- SOIR -->
        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #2196f3;">
            <strong style="color: #2196f3; font-size: 15px; display: block; margin-bottom: 12px;">üåô SOIR (22h00, avant coucher)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(33,150,243,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #2196f3;">
                    <span style="font-size: 14px; flex: 1;">üêü <strong>Om√©ga-3</strong> - 4g <small style="color: #999;">(cardio + inflammation)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(33,150,243,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #2196f3;">
                    <span style="font-size: 14px; flex: 1;">üò¥ <strong>Magn√©sium</strong> - 400mg <small style="color: #999;">(sommeil)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(33,150,243,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #2196f3;">
                    <span style="font-size: 14px; flex: 1;">ü¶¥ <strong>Collag√®ne</strong> - 5g <small style="color: #999;">(r√©cup√©ration nocturne)</small></span>
                </label>
            </div>
        </div>
    </div>

    <!-- CHECKLIST REPOS -->
    <div class="week-card" style="border-left-color: #51cf66;">
        <h3 style="color: #51cf66; margin-bottom: 20px;">üí§ JOURS REPOS (Mar/Jeu/Sam/Dim)</h3>

        <!-- MATIN -->
        <div style="background: #fff9e6; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #ffd93d;">
            <strong style="color: #f59f00; font-size: 15px; display: block; margin-bottom: 12px;">‚òÄÔ∏è MATIN (7h30, √† jeun avec caf√©)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(255,217,61,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #ffd93d;">
                    <span style="font-size: 14px; flex: 1;">‚òÄÔ∏è <strong>Vitamine D3</strong> - 5000 UI <small style="color: #999;">(immunit√©)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(255,217,61,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #ffd93d;">
                    <span style="font-size: 14px; flex: 1;">üí™ <strong>Cr√©atine</strong> - 5g <small style="color: #999;">(saturation musculaire)</small></span>
                </label>
            </div>
        </div>

        <!-- REPAS 1 -->
        <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #51cf66;">
            <strong style="color: #51cf66; font-size: 15px; display: block; margin-bottom: 12px;">üçΩÔ∏è REPAS 1 (12h00, avec repas)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(81,207,102,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #51cf66;">
                    <span style="font-size: 14px; flex: 1;">ü¶¥ <strong>MSM</strong> - 2000mg <small style="color: #999;">(articulations)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(81,207,102,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #51cf66;">
                    <span style="font-size: 14px; flex: 1;">ü¶¥ <strong>Collag√®ne</strong> - 10g <small style="color: #999;">(peau + articulations)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(81,207,102,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #51cf66;">
                    <span style="font-size: 14px; flex: 1;">ü©∏ <strong>Berb√©rine</strong> - 500mg <small style="color: #999;">(glyc√©mie)</small></span>
                </label>
            </div>
        </div>

        <!-- COLLATION -->
        <div style="background: #f3e5f5; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #9c27b0;">
            <strong style="color: #9c27b0; font-size: 15px; display: block; margin-bottom: 12px;">ü•§ COLLATION (16h00)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(156,39,176,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #9c27b0;">
                    <span style="font-size: 14px; flex: 1;">üí™ <strong>Whey</strong> - 30g <small style="color: #999;">(collation prot√©in√©e)</small></span>
                </label>
            </div>
        </div>

        <!-- REPAS 3 -->
        <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #ff9800;">
            <strong style="color: #ff9800; font-size: 15px; display: block; margin-bottom: 12px;">üçΩÔ∏è REPAS 3 (19h30, avec repas)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(255,152,0,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #ff9800;">
                    <span style="font-size: 14px; flex: 1;">ü©∏ <strong>Berb√©rine</strong> - 500mg <small style="color: #999;">(glyc√©mie)</small></span>
                </label>
            </div>
        </div>

        <!-- SOIR -->
        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #2196f3;">
            <strong style="color: #2196f3; font-size: 15px; display: block; margin-bottom: 12px;">üåô SOIR (22h00, avant coucher)</strong>
            <div style="display: grid; gap: 8px;">
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(33,150,243,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #2196f3;">
                    <span style="font-size: 14px; flex: 1;">üêü <strong>Om√©ga-3</strong> - 4g <small style="color: #999;">(cardio + inflammation)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(33,150,243,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #2196f3;">
                    <span style="font-size: 14px; flex: 1;">üò¥ <strong>Magn√©sium</strong> - 400mg <small style="color: #999;">(sommeil)</small></span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; padding: 10px; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white;" onmouseover="this.style.background='rgba(33,150,243,0.15)'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='white'; this.style.transform='translateX(0)'">
                    <input type="checkbox" style="width: 20px; height: 20px; cursor: pointer; accent-color: #2196f3;">
                    <span style="font-size: 14px; flex: 1;">ü¶¥ <strong>Collag√®ne</strong> - 5g <small style="color: #999;">(r√©cup√©ration nocturne)</small></span>
                </label>
            </div>
        </div>
    </div>

    <!-- R√âSUM√â D√âTAILL√â -->
    <div class="week-card" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-left-color: #667eea;">
        <h3 style="color: #667eea; margin-bottom: 15px;">üìã D√âTAILS DES SUPPL√âMENTS</h3>
        <div style="display: grid; gap: 12px;">`;

    Object.entries(stack.liste_complete).forEach(([key, supp]) => {
        html += `
            <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                    <div>
                        <strong style="font-size: 16px; color: #333;">${supp.emoji} ${supp.nom}</strong>
                        <div style="color: #999; font-size: 12px; margin-top: 4px;">üéØ ${supp.objectif}</div>
                    </div>
                    <div style="background: #f0f4ff; padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: 600; color: #667eea;">${supp.prix}</div>
                </div>
                <div style="font-size: 13px; color: #666; line-height: 1.6;">
                    <div>üì¶ Dose: <strong>${supp.dose}</strong></div>
                    <div style="margin-top: 4px;">‚ú® ${supp.effet}</div>
                </div>
            </div>`;
    });

    html += `
        </div>
    </div>`;

    document.getElementById('stack-basique-container').innerHTML = html;
    document.getElementById('stack-diabete-container').innerHTML = '';
    document.getElementById('stack-cholesterol-container').innerHTML = '';
}

// üÜï FONCTION AFFICHAGE AJUSTEMENTS MACROS
function afficherAjustementsMacros() {
    const ajust = AJUSTEMENTS_MACROS.training;
    const details = DETAILS_NUTRITIONNELS;

    let html = '';

    // Option A
    html += `<div class="week-card moderee">
        <div class="week-header">
            <div class="week-title">${ajust.optionA.nom}</div>
            <div class="phase-badge moderee">‚úÖ RECOMMAND√â</div>
        </div>
        <p style="color: #666; margin: 10px 0;">${ajust.optionA.description}</p>`;

    ['repas1', 'repas2', 'repas3'].forEach(repas => {
        const r = ajust.optionA[repas];
        html += `<div class="meal" style="margin: 10px 0;">
            <strong style="color: #667eea;">${repas.toUpperCase()}</strong>
            <div class="meal-foods">
                <ul>${r.modifications.map(m => `<li>${m}</li>`).join('')}</ul>
            </div>
            <div style="background: #f0f4ff; padding: 8px; border-radius: 6px; margin-top: 8px; font-size: 12px;">
                P: ${r.macros.P}g | G: ${r.macros.G}g | L: ${r.macros.L}g | ${r.macros.kcal} kcal
            </div>
        </div>`;
    });

    html += `<div class="stats-grid" style="margin-top: 15px;">
        <div class="stat-item"><div class="stat-label">Prot√©ines</div><div class="stat-value">${ajust.optionA.total.P}g</div></div>
        <div class="stat-item"><div class="stat-label">Glucides</div><div class="stat-value">${ajust.optionA.total.G}g</div></div>
        <div class="stat-item"><div class="stat-label">Lipides</div><div class="stat-value">${ajust.optionA.total.L}g</div></div>
        <div class="stat-item"><div class="stat-label">Calories</div><div class="stat-value">${ajust.optionA.total.kcal}</div></div>
    </div>
    <div class="alert-box alert-success" style="margin-top: 15px;">${ajust.optionA.note}</div>
    </div>`;

    // Option B
    html += `<div class="week-card agressive">
        <div class="week-header">
            <div class="week-title">${ajust.optionB.nom}</div>
            <div class="phase-badge agressive">‚ö†Ô∏è STRICT</div>
        </div>
        <p style="color: #666; margin: 10px 0;">${ajust.optionB.description}</p>`;

    ['repas1', 'repas2', 'repas3'].forEach(repas => {
        const r = ajust.optionB[repas];
        html += `<div class="meal" style="margin: 10px 0;">
            <strong style="color: #ff6b6b;">${repas.toUpperCase()}</strong>
            <div class="meal-foods">
                <ul>${r.modifications.map(m => `<li>${m}</li>`).join('')}</ul>
            </div>
            <div style="background: #ffebee; padding: 8px; border-radius: 6px; margin-top: 8px; font-size: 12px;">
                P: ${r.macros.P}g | G: ${r.macros.G}g | L: ${r.macros.L}g | ${r.macros.kcal} kcal
            </div>
        </div>`;
    });

    html += `<div class="stats-grid" style="margin-top: 15px;">
        <div class="stat-item"><div class="stat-label">Prot√©ines</div><div class="stat-value">${ajust.optionB.total.P}g</div></div>
        <div class="stat-item"><div class="stat-label">Glucides</div><div class="stat-value">${ajust.optionB.total.G}g</div></div>
        <div class="stat-item"><div class="stat-label">Lipides</div><div class="stat-value">${ajust.optionB.total.L}g</div></div>
        <div class="stat-item"><div class="stat-label">Calories</div><div class="stat-value">${ajust.optionB.total.kcal}</div></div>
    </div>
    <div class="alert-box alert-warning" style="margin-top: 15px;">${ajust.optionB.note}</div>
    </div>`;

    document.getElementById('ajustements-container').innerHTML = html;

    // D√©tails nutritionnels
    let htmlDetails = `<div class="info-box"><strong>üí° Astuce :</strong> Ces d√©tails montrent les macros PR√âCISES de chaque aliment pour t'aider √† ajuster tes portions si besoin.</div>`;

    htmlDetails += '<h4 style="margin-top: 15px; color: #667eea;">üèãÔ∏è Jours TRAINING</h4>';

    ['repas1', 'repas2', 'repas3', 'repas3_vendredi'].forEach(repas => {
        const r = details.training[repas];
        if (!r) return;

        htmlDetails += `<div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>${repas.toUpperCase()}</strong> - üí∞ ${r.cout}<br>
            <small style="color: #667eea; font-weight: bold;">Total: P${r.total.P}g | G${r.total.G}g | L${r.total.L}g | ${r.total.kcal} kcal</small>
            <div style="margin-top: 8px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 5px;">`;

        Object.entries(r.aliments).forEach(([nom, macros]) => {
            htmlDetails += `<div style="background: white; padding: 6px; border-radius: 4px; font-size: 11px;">
                <strong>${nom.replace(/_/g, ' ')}</strong><br>
                P:${macros.P}g G:${macros.G}g L:${macros.L}g | ${macros.kcal}kcal
            </div>`;
        });

        htmlDetails += '</div>';
        if (r.note) htmlDetails += `<div style="background: #fff9e6; padding: 6px; border-radius: 4px; margin-top: 5px; font-size: 11px;">${r.note}</div>`;
        htmlDetails += '</div>';
    });

    document.getElementById('details-nutritionnels-container').innerHTML = htmlDetails;
}

// üÜï FONCTIONS MESURES √âDITABLES
function toggleMesuresEdit() {
    const display = document.getElementById('mesures-display');
    const edit = document.getElementById('mesures-edit');

    if (edit.style.display === 'none') {
        display.style.display = 'none';
        edit.style.display = 'block';
    } else {
        display.style.display = 'block';
        edit.style.display = 'none';
    }
}

function updateMesures() {
    const poids = parseFloat(document.getElementById('input-poids-actuel').value) || 93.4;
    const taille = parseFloat(document.getElementById('input-taille-actuel').value) || 105;
    const objectif = parseFloat(document.getElementById('input-objectif').value) || 88;

    document.getElementById('display-poids').textContent = poids.toFixed(1);
    document.getElementById('display-taille').textContent = taille.toFixed(0);
    document.getElementById('display-objectif').textContent = objectif.toFixed(1);

    const perteVisee = poids - objectif;
    document.getElementById('perte-visee').textContent = perteVisee.toFixed(1);
    document.getElementById('kg-restant').textContent = perteVisee.toFixed(1);

    // Sauvegarde
    localStorage.setItem('mesures', JSON.stringify({poids, taille, objectif}));
    showAutoSave();
}

// üÜï FONCTION CALCULATEUR MACROS LIVE
function updateCalculMacros() {
    const p = parseInt(document.getElementById('calc-p-slider').value);
    const g = parseInt(document.getElementById('calc-g-slider').value);
    const l = parseInt(document.getElementById('calc-l-slider').value);

    document.getElementById('calc-p-value').textContent = p;
    document.getElementById('calc-g-value').textContent = g;
    document.getElementById('calc-l-value').textContent = l;

    const pKcal = p * 4;
    const gKcal = g * 4;
    const lKcal = l * 9;
    const total = pKcal + gKcal + lKcal;

    document.getElementById('calc-p-kcal').textContent = pKcal;
    document.getElementById('calc-g-kcal').textContent = gKcal;
    document.getElementById('calc-l-kcal').textContent = lKcal;
    document.getElementById('calc-total-kcal').textContent = total;
}

// üÜï FONCTION DESSIN GRAPHIQUE (simplifi√© avec canvas)
function drawGraph() {
    const canvas = document.getElementById('graph-progression');
    if (!canvas || !canvas.getContext) return;

    const ctx = canvas.getContext('2d');
    const width = canvas.offsetWidth;
    const height = 250;
    canvas.width = width;
    canvas.height = height;

    // Donn√©es exemple
    const data = [93.4, 92.8, 92.3, 91.9, 91.5, 91.0, 90.5, 90.0, 89.5, 89.0, 88.5];
    const objectif = 88;

    // Fond
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(0, 0, width, height);

    // Ligne objectif
    const objY = height - 30;
    ctx.strokeStyle = '#51cf66';
    ctx.lineWidth = 2;
    ctx.setLineDash([5, 5]);
    ctx.beginPath();
    ctx.moveTo(40, objY);
    ctx.lineTo(width - 20, objY);
    ctx.stroke();
    ctx.setLineDash([]);

    // Courbe progression
    ctx.strokeStyle = '#667eea';
    ctx.lineWidth = 3;
    ctx.beginPath();

    const stepX = (width - 60) / (data.length - 1);
    const maxVal = Math.max(...data);
    const minVal = objectif - 1;
    const range = maxVal - minVal;

    data.forEach((val, i) => {
        const x = 40 + i * stepX;
        const y = height - 40 - ((val - minVal) / range * (height - 80));

        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);

        // Points
        ctx.fillStyle = '#667eea';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
    });
    ctx.stroke();

    // Texte
    ctx.fillStyle = '#666';
    ctx.font = '12px Arial';
    ctx.fillText('D√©part', 40, height - 10);
    ctx.fillText('Objectif', width - 70, height - 10);
    ctx.fillStyle = '#51cf66';
    ctx.fillText(objectif + 'kg', 10, objY + 5);
}

// üÜï CHARGER MESURES AU D√âMARRAGE
window.addEventListener('load', function() {
    const saved = localStorage.getItem('mesures');
    if (saved) {
        const {poids, taille, objectif} = JSON.parse(saved);
        document.getElementById('input-poids-actuel').value = poids;
        document.getElementById('input-taille-actuel').value = taille;
        document.getElementById('input-objectif').value = objectif;
        updateMesures();
    }

    // Dessiner graphique si onglet suivi visible
    setTimeout(drawGraph, 500);
});
    </script>
</body>
</html>
